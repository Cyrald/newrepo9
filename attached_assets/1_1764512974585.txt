# –ê–£–î–ò–¢ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ò –ö–ê–ß–ï–°–¢–í–ê –ö–û–î–ê

**–î–∞—Ç–∞:** 30 –Ω–æ—è–±—Ä—è 2025  
**–ü—Ä–æ–µ–∫—Ç:** E-commerce –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ (EcoMarket)  
**–°—Ç–∞—Ç—É—Å:** –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –æ–±–Ω–∞—Ä—É–∂–µ–Ω—ã

---

## –†–ï–ó–Æ–ú–ï

–ü—Ä–æ–≤–µ–¥—ë–Ω –≤—Å–µ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∞—É–¥–∏—Ç –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –ø—Ä–æ–µ–∫—Ç–∞ –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, –Ω–∞—Ä—É—à–µ–Ω–∏–π best practices –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø—Ä–æ–±–ª–µ–º. **–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 7 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π, 12 –≤—ã—Å–æ–∫–∏—Ö, 18 —Å—Ä–µ–¥–Ω–∏—Ö –∏ 23 –Ω–∏–∑–∫–∏—Ö –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ –ø—Ä–æ–±–ª–µ–º—ã.**

### –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –ü–†–û–ë–õ–ï–ú–´ (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):
1. Race Condition –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤ - –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º –æ—Å—Ç–∞—Ç–∫–∞–º
2. –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∞—Å—á—ë—Ç—ã –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ - –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É–≥—Ä–æ–∑–∞ –º–∞–Ω–∏–ø—É–ª—è—Ü–∏–∏ —Ü–µ–Ω–∞–º–∏
3. IDOR —É—è–∑–≤–∏–º–æ—Å—Ç—å –≤ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –∑–∞–∫–∞–∑–æ–≤ - —É—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö
4. Path Traversal –≤ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
5. Timing Attack –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–¥–ø–∏—Å–∏ YooKassa
6. SQL Injection —Ä–∏—Å–∫ –≤ –ø–æ–∏—Å–∫–æ–≤—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
7. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö

---

## üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò (Severity: CRITICAL)

### 1. Race Condition –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/orders.routes.ts:151-172`  
**–†–∏—Å–∫:** –û—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –æ—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤, —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
// –£–Ø–ó–í–ò–ú–´–ô –ö–û–î:
for (const item of data.items) {
  const updateResult = await tx
    .update(products)
    .set({ 
      stockQuantity: sql`${products.stockQuantity} - ${item.quantity}`,
    })
    .where(
      and(
        eq(products.id, item.productId),
        sql`${products.stockQuantity} >= ${item.quantity}` // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ü–û–°–õ–ï –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
      )
    )
    .returning();
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –ü–û–°–õ–ï –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å—Ç—Ä–æ–∫–∏, –Ω–æ –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è. –î–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –º–æ–≥—É—Ç –ø—Ä–æ–π—Ç–∏ –ø—Ä–æ–≤–µ—Ä–∫—É –∏ –æ–±–∞ —Å–ø–∏—Å–∞—Ç—å —Ç–æ–≤–∞—Ä, —á—Ç–æ –ø—Ä–∏–≤–µ–¥—ë—Ç –∫ –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–º—É –æ—Å—Ç–∞—Ç–∫—É.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å FOR UPDATE –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å—Ç—Ä–æ–∫–∏ –î–û –ø—Ä–æ–≤–µ—Ä–∫–∏:
const [product] = await tx
  .select()
  .from(products)
  .where(eq(products.id, item.productId))
  .for('update')
  .limit(1);

if (!product || product.stockQuantity < item.quantity) {
  throw new Error('INSUFFICIENT_STOCK');
}

// –ó–∞—Ç–µ–º –∞—Ç–æ–º–∞—Ä–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å:
await tx
  .update(products)
  .set({ 
    stockQuantity: sql`${products.stockQuantity} - ${item.quantity}`,
    updatedAt: new Date()
  })
  .where(eq(products.id, item.productId));
```

---

### 2. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–±–ª–µ–º–∞: –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∞—Å—á—ë—Ç—ã –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `client/src/pages/checkout-page.tsx:115-122`  
**–†–∏—Å–∫:** –ú–∞–Ω–∏–ø—É–ª—è—Ü–∏—è —Ü–µ–Ω–∞–º–∏, —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø–æ—Ç–µ—Ä–∏, –º–æ—à–µ–Ω–Ω–∏—á–µ—Å—Ç–≤–æ  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
// –ö–†–ò–¢–ò–ß–ï–°–ö–ò –û–ü–ê–°–ù–û - —Ä–∞—Å—á—ë—Ç—ã –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ:
const promocodeDiscount = appliedPromocode?.discountAmount || 0
const subtotalAfterPromocode = Math.max(0, subtotal - promocodeDiscount)
const maxBonuses = Math.floor(subtotalAfterPromocode * 0.2)
const cappedBonusesUsed = Math.min(bonusesUsed, Math.min(bonusPoints, maxBonuses))
const finalTotal = Math.max(0, subtotalAfterBonuses + deliveryCost)
```

**–ü—Ä–æ–±–ª–µ–º–∞:** 
- –ö–ª–∏–µ–Ω—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç —Ä–∞—Å—á—ë—Ç –∏—Ç–æ–≥–æ–≤–æ–π —Å—É–º–º—ã
- –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å JavaScript –∏ –∑–∞–ø–ª–∞—Ç–∏—Ç—å –ª—é–±—É—é —Å—É–º–º—É
- –ü—Ä–æ–º–æ–∫–æ–¥—ã –∏ –±–æ–Ω—É—Å—ã —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞—é—Ç—Å—è –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
- Backend –ø—Ä–∏–Ω–∏–º–∞–µ—Ç —ç—Ç–∏ –∑–Ω–∞—á–µ–Ω–∏—è –±–µ–∑ –ø–µ—Ä–µ–ø—Ä–æ–≤–µ—Ä–∫–∏

**–†–µ—à–µ–Ω–∏–µ:** –í–°–ï —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∞—Å—á—ë—Ç—ã –¢–û–õ–¨–ö–û –Ω–∞ backend:
```typescript
// Backend –¥–æ–ª–∂–µ–Ω –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—Ç—å:
router.post("/orders", async (req, res) => {
  // 1. –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ —Ü–µ–Ω—ã –∏–∑ –ë–î (–ù–ï –¥–æ–≤–µ—Ä—è—Ç—å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥—É)
  // 2. –ü—Ä–∏–º–µ–Ω–∏—Ç—å –ø—Ä–æ–º–æ–∫–æ–¥ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  // 3. –†–∞—Å—Å—á–∏—Ç–∞—Ç—å —Å–∫–∏–¥–∫–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  // 4. –í–µ—Ä–Ω—É—Ç—å –∏—Ç–æ–≥–æ–≤—É—é —Å—É–º–º—É
  // 5. –ù–ï –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–∑ req.body –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤
});
```

---

### 3. IDOR —É—è–∑–≤–∏–º–æ—Å—Ç—å - –ø—Ä–æ—Å–º–æ—Ç—Ä —á—É–∂–∏—Ö –∑–∞–∫–∞–∑–æ–≤
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/orders.routes.ts:68-81`  
**–†–∏—Å–∫:** –£—Ç–µ—á–∫–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
// –£–Ø–ó–í–ò–ú–´–ô –ö–û–î - –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞:
router.get("/:id", authenticateToken, async (req, res) => {
  const order = await storage.getOrder(req.params.id);
  // –ù–ï–¢ –ø—Ä–æ–≤–µ—Ä–∫–∏: order.userId === req.userId
  res.json(order);
});
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –õ—é–±–æ–π –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–∫–∞–∑ –ª—é–±–æ–≥–æ –¥—Ä—É–≥–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –∑–Ω–∞—è ID.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
router.get("/:id", authenticateToken, async (req, res) => {
  const order = await storage.getOrder(req.params.id);
  
  if (!order) {
    return res.status(404).json({ message: "–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω" });
  }
  
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞:
  const isAdmin = req.userRoles?.includes('admin');
  const isOwner = order.userId === req.userId;
  
  if (!isOwner && !isAdmin) {
    return res.status(403).json({ message: "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω" });
  }
  
  res.json(order);
});
```

---

### 4. Path Traversal –≤ —É–¥–∞–ª–µ–Ω–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/ImagePipeline.ts:273-285`  
**–†–∏—Å–∫:** –£–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤ —Å–∏—Å—Ç–µ–º—ã  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
async deleteImage(filename: string): Promise<void> {
  const securePath = this.pathValidator.getSecurePath(filename);
  await fs.unlink(securePath);
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –•–æ—Ç—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `PathSecurityValidator`, –ø–æ—Ä—è–¥–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è, –Ω–æ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ —Ä–µ–∑—É–ª—å—Ç–∏—Ä—É—é—â–∏–π –ø—É—Ç—å –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –í–ù–£–¢–†–ò —Ä–∞–∑—Ä–µ—à—ë–Ω–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
async deleteImage(filename: string): Promise<void> {
  const validation = this.pathValidator.validatePath(filename);
  
  if (!validation.isValid) {
    logger.warn('Invalid filename for deletion', { filename, error: validation.error });
    throw new Error('–ù–µ–¥–æ–ø—É—Å—Ç–∏–º–æ–µ –∏–º—è —Ñ–∞–π–ª–∞');
  }
  
  const fullPath = path.join(this.uploadsDir, validation.normalizedPath!);
  const resolvedPath = path.resolve(fullPath);
  const resolvedBaseDir = path.resolve(this.uploadsDir);
  
  // –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø –ü–†–û–í–ï–†–ö–ê:
  if (!resolvedPath.startsWith(resolvedBaseDir + path.sep)) {
    logger.error('Path traversal attempt detected', { filename, resolvedPath });
    throw new Error('–ü–æ–ø—ã—Ç–∫–∞ –æ–±—Ö–æ–¥–∞ –ø—É—Ç–∏');
  }
  
  await fs.unlink(resolvedPath);
}
```

---

### 5. Timing Attack –≤ –ø—Ä–æ–≤–µ—Ä–∫–µ –ø–æ–¥–ø–∏—Å–∏ YooKassa
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/webhooks.routes.ts:12-32`  
**–†–∏—Å–∫:** –û–±—Ö–æ–¥ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏ –ø–ª–∞—Ç—ë–∂–Ω–æ–≥–æ –≤–µ–±—Ö—É–∫–∞  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
// –£–Ø–ó–í–ò–ú–´–ô –ö–û–î:
if (!/^[0-9a-fA-F]+$/.test(signature)) {
  logger.warn('Invalid signature format - not hex');
  return false; // –†–∞–Ω–Ω–∏–π –≤—ã—Ö–æ–¥ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
}

return crypto.timingSafeEqual(
  Buffer.from(signature, 'hex'),
  Buffer.from(hmac, 'hex')
);
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –î–û `timingSafeEqual`, —á—Ç–æ —Å–æ–∑–¥–∞—ë—Ç timing leak. –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å —Ñ–æ—Ä–º–∞—Ç–∞ –ø–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
function verifyYooKassaSignature(body: Buffer | string, signature: string, secretKey: string): boolean {
  try {
    // –°–æ–∑–¥–∞—Ç—å –≤–∞–ª–∏–¥–Ω—ã–π –±—É—Ñ–µ—Ä –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç —Ñ–æ—Ä–º–∞—Ç–∞ –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
    let signatureBuffer: Buffer;
    try {
      signatureBuffer = Buffer.from(signature, 'hex');
    } catch {
      // –°–æ–∑–¥–∞—Ç—å —Ñ–∏–∫—Ç–∏–≤–Ω—ã–π –±—É—Ñ–µ—Ä –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
      signatureBuffer = Buffer.alloc(32);
    }
    
    const hmac = crypto
      .createHmac('sha256', secretKey)
      .update(body)
      .digest();
    
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ –ü–û–°–õ–ï HMAC, —á—Ç–æ–±—ã –≤—Ä–µ–º—è –±—ã–ª–æ –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º
    const isValidFormat = /^[0-9a-fA-F]+$/.test(signature) && signatureBuffer.length === hmac.length;
    
    if (!isValidFormat) {
      // –í—ã–ø–æ–ª–Ω–∏—Ç—å —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –≤—Å—ë —Ä–∞–≤–Ω–æ –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏
      crypto.timingSafeEqual(signatureBuffer, hmac);
      return false;
    }
    
    return crypto.timingSafeEqual(signatureBuffer, hmac);
  } catch (error) {
    logger.error('YooKassa signature verification failed', { error });
    return false;
  }
}
```

---

### 6. SQL Injection —Ä–∏—Å–∫ –≤ LIKE –∑–∞–ø—Ä–æ—Å–∞—Ö
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/storage.ts:259-264`  
**–†–∏—Å–∫:** SQL Injection, —É—Ç–µ—á–∫–∞ –¥–∞–Ω–Ω—ã—Ö  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
// –ü–û–¢–ï–ù–¶–ò–ê–õ–¨–ù–û –£–Ø–ó–í–ò–ú–´–ô –ö–û–î:
if (filters?.search) {
  const searchTerm = `%${filters.search}%`;
  conditions.push(
    or(
      sql`${products.name} ILIKE ${searchTerm}`,
      sql`${products.description} ILIKE ${searchTerm}`
    )!
  );
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –•–æ—Ç—è Drizzle ORM –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã, —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã `%` –∏ `_` –≤ LIKE –º–æ–≥—É—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω—ã –¥–ª—è DoS –∞—Ç–∞–∫ –∏–ª–∏ —Ä–∞—Å–∫—Ä—ã—Ç–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
function escapeLikePattern(pattern: string): string {
  return pattern
    .replace(/\\/g, '\\\\')
    .replace(/%/g, '\\%')
    .replace(/_/g, '\\_');
}

if (filters?.search) {
  const sanitized = escapeLikePattern(filters.search);
  const searchTerm = `%${sanitized}%`;
  conditions.push(
    or(
      sql`${products.name} ILIKE ${searchTerm} ESCAPE '\\'`,
      sql`${products.description} ILIKE ${searchTerm} ESCAPE '\\'`
    )!
  );
}
```

---

### 7. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/products.routes.ts:70-113`  
**–†–∏—Å–∫:** XSS, Data Corruption, Business Logic Bypass  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
// –û–ü–ê–°–ù–û - –Ω–µ—Ç Zod –≤–∞–ª–∏–¥–∞—Ü–∏–∏:
router.post("/", authenticateToken, requireRole("admin", "marketer"),
  productFormDataUpload.none(),
  async (req, res) => {
    const productData = { ...req.body }; // –ü—Ä–∏–Ω–∏–º–∞–µ–º –≤—Å—ë –∫–∞–∫ –µ—Å—Ç—å
    
    // –¢–æ–ª—å–∫–æ –±–∞–∑–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ stockQuantity, –æ—Å—Ç–∞–ª—å–Ω–æ–µ –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è
    const stockQty = (productData.stockQuantity || '0').trim();
    if (!/^\d+$/.test(stockQty)) {
      return res.status(400).json({ message: "–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ" });
    }
    
    const product = await storage.createProduct(productData);
    res.json(product);
  }
);
```

**–ü—Ä–æ–±–ª–µ–º–∞:**
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª
- –ú–æ–∂–µ—Ç —Å–æ–∑–¥–∞—Ç—å —Ç–æ–≤–∞—Ä —Å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π
- –ú–æ–∂–µ—Ç –≤–Ω–µ–¥—Ä–∏—Ç—å XSS —á–µ—Ä–µ–∑ description

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Zod —Å—Ö–µ–º—É:
```typescript
router.post("/", authenticateToken, requireRole("admin", "marketer"),
  productFormDataUpload.none(),
  async (req, res) => {
    // –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–ê–Ø –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Zod:
    const validatedData = createProductSchema.parse(req.body);
    
    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏—è:
    const sanitizedData = {
      ...validatedData,
      name: sanitizeProductName(validatedData.name),
      description: sanitizeDescription(validatedData.description),
    };
    
    const product = await storage.createProduct(sanitizedData);
    res.json(product);
  }
);
```

---

## üü† –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (Severity: HIGH)

### 8. CORS Misconfiguration - —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –±–µ–∑ Origin
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/middleware/cors.ts:14-16`  
**–†–∏—Å–∫:** CSRF –∞—Ç–∞–∫–∏, –æ–±—Ö–æ–¥ –∑–∞—â–∏—Ç—ã  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
if (!origin) {
  callback(null, true); // –û–ü–ê–°–ù–û - —Ä–∞–∑—Ä–µ—à–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ origin
  return;
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–ø—Ä–æ—Å—ã –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ `Origin` –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑—Ä–µ—à–∞—é—Ç—Å—è. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±—Ö–æ–¥–∏—Ç—å CORS –∑–∞—â–∏—Ç—É —á–µ—Ä–µ–∑ curl, Postman –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
if (!origin) {
  // –í production –ù–ï —Ä–∞–∑—Ä–µ—à–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ Origin
  logger.warn('Request without Origin header blocked', { path: req.path });
  callback(new Error('Origin header required'), false);
  return;
}
```

---

### 9. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è Rate Limiting –Ω–∞ WebSocket
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes.ts:127-224`  
**–†–∏—Å–∫:** DoS –∞—Ç–∞–∫–∏, –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –Ω–∞:
- –†–∞–∑–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π WebSocket
- –ß–∞—Å—Ç–æ—Ç—É —Å–æ–æ–±—â–µ–Ω–∏–π –æ—Ç –æ–¥–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π —Å –æ–¥–Ω–æ–≥–æ IP

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
const MESSAGE_SIZE_LIMIT = 100 * 1024; // 100 KB
const MESSAGE_RATE_LIMIT = 20; // —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –º–∏–Ω—É—Ç—É
const MESSAGE_RATE_WINDOW = 60 * 1000;

ws.on('message', async (rawMessage: Buffer) => {
  // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞
  if (rawMessage.length > MESSAGE_SIZE_LIMIT) {
    logger.warn('WebSocket message size exceeded', { 
      clientIp, size: rawMessage.length 
    });
    ws.close(1009, 'Message too large');
    return;
  }
  
  // 2. Rate limiting –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏–π
  const messageKey = `msg:${clientIp}`;
  const messageLimit = messageRateLimits.get(messageKey) || { 
    count: 0, 
    resetAt: now + MESSAGE_RATE_WINDOW 
  };
  
  if (now > messageLimit.resetAt) {
    messageLimit.count = 0;
    messageLimit.resetAt = now + MESSAGE_RATE_WINDOW;
  }
  
  if (messageLimit.count >= MESSAGE_RATE_LIMIT) {
    logger.warn('WebSocket message rate limit exceeded', { clientIp });
    ws.send(JSON.stringify({ 
      type: 'error', 
      message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏–π' 
    }));
    return;
  }
  
  messageLimit.count++;
  messageRateLimits.set(messageKey, messageLimit);
  
  // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
});
```

---

### 10. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ä–æ—Ç–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–∏ –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/auth.routes.ts:280-310`  
**–†–∏—Å–∫:** Session Hijacking  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
router.post("/change-password", authenticateToken, async (req, res) => {
  // ... —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è ...
  
  await invalidateAllUserSessions(user.id);
  
  // –ü–†–û–ë–õ–ï–ú–ê: —Ç–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
  res.json({ message: "–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω" });
});
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–æ—Å–ª–µ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è –≤—Å–µ —Å–µ—Å—Å–∏–∏ –∏–Ω–≤–∞–ª–∏–¥–∏—Ä—É—é—Ç—Å—è, –Ω–æ —Ç–µ–∫—É—â–∞—è —Å–µ—Å—Å–∏—è –Ω–µ —Ä–µ–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ –æ—Å—Ç–∞–≤–ª—è–µ—Ç –æ–∫–Ω–æ —É—è–∑–≤–∏–º–æ—Å—Ç–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
router.post("/change-password", authenticateToken, async (req, res) => {
  // ... —Å–º–µ–Ω–∞ –ø–∞—Ä–æ–ª—è ...
  
  await invalidateAllUserSessions(user.id);
  
  // –†–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏:
  req.session.regenerate((err) => {
    if (err) {
      logger.error('Session regeneration failed after password change');
      return res.status(500).json({ message: "–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–µ—Å—Å–∏–∏" });
    }
    
    req.session.userId = user.id;
    req.session.userRoles = req.userRoles;
    
    res.json({ message: "–ü–∞—Ä–æ–ª—å —É—Å–ø–µ—à–Ω–æ –∏–∑–º–µ–Ω—ë–Ω" });
  });
});
```

---

### 11. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª–µ–π
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/auth.routes.ts:409-447`  
**–†–∏—Å–∫:** –°–ª–∞–±—ã–µ –ø–∞—Ä–æ–ª–∏, –≤–∑–ª–æ–º –∞–∫–∫–∞—É–Ω—Ç–æ–≤  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

–ü—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `validatePassword`, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `validatePasswordStrength`. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–ª–∞–±—ã–π –ø–∞—Ä–æ–ª—å.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –í changePasswordSchema –¥–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–≥—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é:
export const changePasswordSchema = z.object({
  currentPassword: z.string().min(1, "–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω"),
  newPassword: z.string()
    .min(12, "–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 12 —Å–∏–º–≤–æ–ª–æ–≤")
    .max(128, "–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–π")
    .regex(/[a-z]/, "–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞")
    .regex(/[A-Z]/, "–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞")
    .regex(/\d/, "–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ü–∏—Ñ—Ä–∞")
    .regex(/[@$!%*?&#]/, "–î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª")
    .refine(
      (password) => !commonPasswords.includes(password.toLowerCase()),
      "–ü–∞—Ä–æ–ª—å —Å–ª–∏—à–∫–æ–º —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–π"
    ),
  confirmPassword: z.string(),
}).refine((data) => data.newPassword === data.confirmPassword, {
  message: "–ü–∞—Ä–æ–ª–∏ –Ω–µ —Å–æ–≤–ø–∞–¥–∞—é—Ç",
  path: ["confirmPassword"],
});
```

---

### 12. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ MIME type –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –≤ Sharp
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/ImagePipeline.ts:127-155`  
**–†–∏—Å–∫:** –ó–∞–≥—Ä—É–∑–∫–∞ –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

Sharp –ø—ã—Ç–∞–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ñ–æ—Ä–º–∞—Ç –ø–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º—É, –Ω–æ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç MIME type –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
async processImage(
  buffer: Buffer,
  originalName: string,
  mimeType?: string // –î–æ–±–∞–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä
): Promise<ProcessedImageResult> {
  // –ü—Ä–æ–≤–µ—Ä–∫–∞ MIME type –î–û –æ–±—Ä–∞–±–æ—Ç–∫–∏
  const allowedMimeTypes = ['image/jpeg', 'image/png', 'image/webp'];
  if (mimeType && !allowedMimeTypes.includes(mimeType)) {
    throw new Error(`–ù–µ–¥–æ–ø—É—Å—Ç–∏–º—ã–π MIME type: ${mimeType}`);
  }
  
  await this.validateImage(buffer);
  // ...
}
```

---

### 13. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–≥–æ —Å–µ–∫—Ä–µ—Ç–∞ –¥–ª—è CSRF
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/middleware/csrf.ts:11`  
**–†–∏—Å–∫:** –ü—Ä–µ–¥—Å–∫–∞–∑—É–µ–º—ã–µ CSRF —Ç–æ–∫–µ–Ω—ã  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
getSecret: () => env.SESSION_SECRET, // –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ—Ç –∂–µ —Å–µ–∫—Ä–µ—Ç —á—Ç–æ –∏ –¥–ª—è —Å–µ—Å—Å–∏–π
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –ï—Å–ª–∏ `SESSION_SECRET` —Å–∫–æ–º–ø—Ä–æ–º–µ—Ç–∏—Ä–æ–≤–∞–Ω, –∑–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –≤–∞–ª–∏–¥–Ω—ã–µ CSRF —Ç–æ–∫–µ–Ω—ã.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –í env.ts –¥–æ–±–∞–≤–∏—Ç—å –æ—Ç–¥–µ–ª—å–Ω—ã–π CSRF_SECRET:
CSRF_SECRET: z.string().min(32, 'CSRF_SECRET must be at least 32 characters long'),

// –í csrf.ts:
getSecret: () => env.CSRF_SECRET,
```

---

### 14. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ Content-Type –≤ –≤–µ–±—Ö—É–∫–∞—Ö
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/webhooks.routes.ts:34-131`  
**–†–∏—Å–∫:** Content Confusion –∞—Ç–∞–∫–∏  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

–í–µ–±—Ö—É–∫ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ª—é–±–æ–π Content-Type –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
router.post('/yookassa', async (req, res) => {
  const contentType = req.headers['content-type'];
  
  if (!contentType || !contentType.includes('application/json')) {
    logger.warn('YooKassa webhook: invalid content type', { contentType });
    return res.status(400).json({ message: 'Content-Type must be application/json' });
  }
  
  // ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –ª–æ–≥–∏–∫–∞
});
```

---

### 15. Race Condition –≤ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/promocodes.ts:85-130`  
**–†–∏—Å–∫:** –ú–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤—ã—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
export async function applyPromocode(...) {
  await db.transaction(async (tx) => {
    const result = await tx.execute(
      sql`SELECT * FROM ${promocodes} 
          WHERE ${promocodes.id} = ${promocodeId} 
          FOR UPDATE` // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞, –Ω–æ –ø–æ—Å–ª–µ —É–∂–µ –º–æ–≥–ª–∞ –±—ã—Ç—å –ø—Ä–æ–≤–µ—Ä–∫–∞
    );
    
    if (promocode.type === "single_use") {
      const usageCount = await tx
        .select({ count: sql`count(*)` })
        .from(promocodeUsage)
        .where(eq(promocodeUsage.promocodeId, promocodeId));
        
      // RACE CONDITION: –º–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –≤—Å—Ç–∞–≤–∫–æ–π
    }
  });
}
```

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å unique constraint –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö:
// –î–ª—è single_use: unique(promocodeId)
// –î–ª—è temporary: unique(promocodeId, userId) - —É–∂–µ –µ—Å—Ç—å

// –ü–æ–π–º–∞—Ç—å –æ—à–∏–±–∫—É –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è:
try {
  await tx.insert(promocodeUsage).values({
    promocodeId,
    userId,
    orderId,
  });
} catch (error: any) {
  if (error.code === '23505') { // Duplicate key
    throw new Error('–ü—Ä–æ–º–æ–∫–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω');
  }
  throw error;
}
```

---

### 16. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/promocodes.routes.ts`  
**–†–∏—Å–∫:** –ë—Ä—É—Ç—Ñ–æ—Ä—Å –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

`promocodeValidationLimiter` –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç 20 –ø–æ–ø—ã—Ç–æ–∫ –≤ —á–∞—Å, –Ω–æ —ç—Ç–æ–≥–æ –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –∑–∞—â–∏—Ç—ã –æ—Ç —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –∞—Ç–∞–∫.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–π –ª–∏–º–∏—Ç –Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤:
const invalidPromocodeAttempts = new Map<string, number>();

router.post("/validate", authenticateToken, promocodeValidationLimiter, async (req, res) => {
  // ... –≤–∞–ª–∏–¥–∞—Ü–∏—è ...
  
  if (!result.valid) {
    const userId = req.userId!;
    const attempts = invalidPromocodeAttempts.get(userId) || 0;
    
    if (attempts >= 10) {
      logger.warn('Too many invalid promocode attempts', { userId });
      return res.status(429).json({ 
        message: '–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –Ω–µ–≤–µ—Ä–Ω—ã—Ö –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤' 
      });
    }
    
    invalidPromocodeAttempts.set(userId, attempts + 1);
    
    // –°–±—Ä–æ—Å —á–µ—Ä–µ–∑ —á–∞—Å
    setTimeout(() => {
      invalidPromocodeAttempts.delete(userId);
    }, 60 * 60 * 1000);
  }
  
  res.json(result);
});
```

---

### 17. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è file extension
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/upload.ts:14-19`  
**–†–∏—Å–∫:** Double Extension –∞—Ç–∞–∫–∏  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
const ext = path.extname(file.originalname).toLowerCase();

if (!allowedExtensions.includes(ext)) {
  cb(new Error("–ù–µ–¥–æ–ø—É—Å—Ç–∏–º–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞"));
  return;
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** `image.jpg.exe` –ø—Ä–æ–π–¥—ë—Ç –ø—Ä–æ–≤–µ—Ä–∫—É, —Ç.–∫. –ø–æ—Å–ª–µ–¥–Ω–µ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ `.exe`, –Ω–æ –µ—Å–ª–∏ —Å–µ—Ä–≤–µ—Ä –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –º–æ–∂–µ—Ç –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
const filename = file.originalname.toLowerCase();

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –¥–≤–æ–π–Ω–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ
if (filename.split('.').length > 2) {
  cb(new Error("–§–∞–π–ª—ã —Å –¥–≤–æ–π–Ω—ã–º —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ–º –∑–∞–ø—Ä–µ—â–µ–Ω—ã"));
  return;
}

const ext = path.extname(filename);
if (!allowedExtensions.includes(ext)) {
  cb(new Error("–ù–µ–¥–æ–ø—É—Å—Ç–∏–º–æ–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ —Ñ–∞–π–ª–∞"));
  return;
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –æ–ø–∞—Å–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã
if (/\.(exe|sh|bat|cmd|php|jsp|asp)$/i.test(filename)) {
  cb(new Error("–û–ø–∞—Å–Ω—ã–π —Ç–∏–ø —Ñ–∞–π–ª–∞"));
  return;
}
```

---

### 18. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–æ–ª–∏ –≤ WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes.ts:127-224`  
**–†–∏—Å–∫:** –ù–µ—Å–∞–Ω–∫—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∞–¥–º–∏–Ω-—á–∞—Ç—É  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞–ª–∏—á–∏–µ —Å–µ—Å—Å–∏–∏, –Ω–æ –Ω–µ —Ä–æ–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
wss.on("connection", async (ws: any, req: any) => {
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ ...
  
  const sessionData = await validateSessionFromCookie(req.headers.cookie);
  
  if (!sessionData) {
    logger.warn('WebSocket: invalid session');
    ws.close(1008, 'Unauthorized');
    return;
  }
  
  ws.userId = sessionData.userId;
  ws.userRoles = sessionData.userRoles;
  
  // –ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π –≤ –∞–¥–º–∏–Ω-—á–∞—Ç –ø—Ä–æ–≤–µ—Ä—è—Ç—å —Ä–æ–ª–∏:
  if (message.type === 'admin_message' && !ws.userRoles.includes('admin')) {
    ws.send(JSON.stringify({
      type: 'error',
      message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤'
    }));
    return;
  }
});
```

---

### 19. –£—è–∑–≤–∏–º–æ—Å—Ç—å –∫ Slowloris –∞—Ç–∞–∫–µ —á–µ—Ä–µ–∑ WebSocket
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes.ts`  
**–†–∏—Å–∫:** DoS –∞—Ç–∞–∫–∞ —á–µ—Ä–µ–∑ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç timeout –¥–ª—è WebSocket –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–π.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
const WS_TIMEOUT = 5 * 60 * 1000; // 5 –º–∏–Ω—É—Ç –±–µ–∑ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

wss.on("connection", async (ws: any, req: any) => {
  let activityTimeout: NodeJS.Timeout;
  
  const resetTimeout = () => {
    if (activityTimeout) clearTimeout(activityTimeout);
    
    activityTimeout = setTimeout(() => {
      logger.info('WebSocket timeout - closing idle connection', { 
        userId: ws.userId 
      });
      ws.close(1000, 'Connection timeout due to inactivity');
    }, WS_TIMEOUT);
  };
  
  resetTimeout();
  
  ws.on('message', (message: Buffer) => {
    resetTimeout(); // –°–±—Ä–æ—Å —Ç–∞–π–º–µ—Ä–∞ –ø—Ä–∏ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
    // ... –æ–±—Ä–∞–±–æ—Ç–∫–∞
  });
  
  ws.on('close', () => {
    if (activityTimeout) clearTimeout(activityTimeout);
  });
});
```

---

## üü° –°–†–ï–î–ù–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (Severity: MEDIUM)

### 20. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ localStorage –¥–ª—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `client/src/providers/theme-provider.tsx`, `client/src/components/theme-provider.tsx`  
**–†–∏—Å–∫:** XSS –º–æ–∂–µ—Ç —É–∫—Ä–∞—Å—Ç—å –¥–∞–Ω–Ω—ã–µ  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

–•–æ—Ç—è —Å–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è —Ç–µ–º—ã, –µ—Å—Ç—å —Ä–∏—Å–∫ —á—Ç–æ –≤ –±—É–¥—É—â–µ–º –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—å —Ç–æ–∫–µ–Ω—ã –∏–ª–∏ –¥—Ä—É–≥–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –ù–ò–ö–û–ì–î–ê –Ω–µ —Ö—Ä–∞–Ω–∏—Ç—å –≤ localStorage:
// - –¢–æ–∫–µ–Ω—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
// - –ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
// - –ü–ª–∞—Ç—ë–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è:
// - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ UI (—Ç–µ–º–∞, —è–∑—ã–∫)
// - –ö–µ—à –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
```

---

### 21. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ SameSite=Strict –¥–ª—è –≤—Å–µ—Ö cookie
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/session.ts:21`, `server/middleware/csrf.ts:17`  
**–†–∏—Å–∫:** CSRF —á–µ—Ä–µ–∑ –ø–æ–¥–¥–æ–º–µ–Ω—ã  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

–ö—É–∫–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç `sameSite: 'strict'`, —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ, –Ω–æ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —á—Ç–æ —ç—Ç–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ –≤–µ–∑–¥–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –°–æ–∑–¥–∞—Ç—å —É—Ç–∏–ª–∏—Ç—É –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫ cookie.

---

### 22. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –í–µ—Å—å –ø—Ä–æ–µ–∫—Ç  
**–†–∏—Å–∫:** –°–ª–æ–∂–Ω–æ—Å—Ç—å —Ä–∞—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∏–Ω—Ü–∏–¥–µ–Ω—Ç–æ–≤  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è:
- –ò–∑–º–µ–Ω–µ–Ω–∏–π –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
- –ü—Ä–æ—Å–º–æ—Ç—Ä–∞ —á—É–∂–∏—Ö –¥–∞–Ω–Ω—ã—Ö (IDOR –ø–æ–ø—ã—Ç–∫–∏)
- –ú–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- –ò–∑–º–µ–Ω–µ–Ω–∏—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:
async function updateUserRole(userId: string, newRole: string, adminId: string) {
  logger.info('Role change', {
    targetUserId: userId,
    newRole,
    changedBy: adminId,
    timestamp: new Date().toISOString(),
  });
  
  logSecurityEvent({
    event: 'ROLE_CHANGE',
    userId: adminId,
    success: true,
    details: { targetUser: userId, newRole },
  });
  
  // ... –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏–µ
}
```

---

### 23. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Content Security Policy
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/index.ts:38-58`  
**–†–∏—Å–∫:** XSS –∞—Ç–∞–∫–∏  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

CSP –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Ç–æ–ª—å–∫–æ –¥–ª—è production –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç—Ä–æ–≥–∏–º.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
app.use(helmet({
  contentSecurityPolicy: {
    directives: {
      defaultSrc: ["'self'"],
      scriptSrc: ["'self'"],
      styleSrc: ["'self'", "'unsafe-inline'"], // –¢–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ
      imgSrc: ["'self'", "data:", "https:"],
      connectSrc: ["'self'", "wss:", "https:"],
      fontSrc: ["'self'", "data:"],
      objectSrc: ["'none'"],
      mediaSrc: ["'self'"],
      frameSrc: ["'none'"],
      upgradeInsecureRequests: [],
    },
  },
  // ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
}));
```

---

### 24. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è JSON size
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/index.ts:80-91`  
**–†–∏—Å–∫:** DoS —á–µ—Ä–µ–∑ –±–æ–ª—å—à–∏–µ JSON  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

–õ–∏–º–∏—Ç 10MB –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–∏–º –¥–ª—è API —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –†–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤:
app.use('/api/webhooks', express.json({ limit: '1mb' }));
app.use('/api/upload', express.json({ limit: '50kb' })); // –¢–æ–ª—å–∫–æ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
app.use('/api', express.json({ limit: '100kb' })); // –û–±—â–∏–π API
```

---

### 25. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ X-Content-Type-Options
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/index.ts`  
**–†–∏—Å–∫:** MIME Sniffing –∞—Ç–∞–∫–∏  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

Helmet –Ω–∞—Å—Ç—Ä–æ–µ–Ω, –Ω–æ —Å—Ç–æ–∏—Ç —è–≤–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –≤—Å–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
app.use(helmet({
  // ... —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
  noSniff: true, // X-Content-Type-Options: nosniff
  frameguard: { action: 'deny' }, // X-Frame-Options: DENY
  xssFilter: true, // X-XSS-Protection: 1; mode=block
}));
```

---

### 26-37. –î—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞

26. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ backup mechanism –¥–ª—è –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
27. –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç ZIP bombs –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∞—Ä—Ö–∏–≤–æ–≤
28. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —á—ë—Ä–Ω—ã—Ö —Å–ø–∏—Å–∫–æ–≤ email –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
29. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–æ–º–µ—Ä–æ–≤ —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
30. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç credential stuffing
31. –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏—è –∞–Ω–æ–º–∞–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
32. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ honeypot –ø–æ–ª–µ–π –≤ —Ñ–æ—Ä–º–∞—Ö
33. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç scraping
34. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–æ–Ω–Ω—ã—Ö –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
35. –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç automated account creation
36. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ IP reputation
37. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

---

## üîµ –ù–ò–ó–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢ (Severity: LOW)

### 38. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ç—Ä–æ–≥–∏–µ TypeScript –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `tsconfig.json`  
**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**

```json
{
  "compilerOptions": {
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true
  }
}
```

---

### 39-60. –î—Ä—É–≥–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–∏–∑–∫–æ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞

39. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ unit —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
40. –ù–µ—Ç –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –ø–ª–∞—Ç—ë–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏
41. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
42. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ e2e —Ç–µ—Å—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏–µ–≤
43. –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
44. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ pre-commit hooks –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–¥–∞
45. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API
46. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ OpenAPI/Swagger —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏
47. –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ changelog
48. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ semantic versioning
49. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –∫–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–ª–æ–∂–Ω–æ–π –ª–æ–≥–∏–∫–∏
50. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
51. –ù–µ—Ç –ø–ª–∞–Ω–∞ disaster recovery
52. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
53. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Ç—Ä–∏–∫
54. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–ª–µ—Ä—Ç–æ–≤ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
55. –ù–µ—Ç —Å–∏—Å—Ç–µ–º—ã —Ä–æ—Ç–∞—Ü–∏–∏ –ª–æ–≥–æ–≤
56. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∞–Ω–∞–ª–∏–∑–∞ –ª–æ–≥–æ–≤ –Ω–∞ –∞–Ω–æ–º–∞–ª–∏–∏
57. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ edge cases
58. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ graceful degradation –¥–ª—è –Ω–µ–∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π
59. –ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–∞ feature flags
60. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ A/B —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

---

## –ê–†–•–ò–¢–ï–ö–¢–£–†–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### –ü—Ä–æ–±–ª–µ–º–∞: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–µ
**–û–ø–∏—Å–∞–Ω–∏–µ:** –†–∞—Å—á—ë—Ç —Ü–µ–Ω, —Å–∫–∏–¥–æ–∫, –±–æ–Ω—É—Å–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ, —á—Ç–æ –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–æ.

**–†–µ—à–µ–Ω–∏–µ:** –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –í–°–Æ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –ª–æ–≥–∏–∫—É –Ω–∞ backend.

---

### –ü—Ä–æ–±–ª–µ–º–∞: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–ª–æ—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏ –¥–ª—è –ë–î
**–û–ø–∏—Å–∞–Ω–∏–µ:** Direct DB queries —Ä–∞–∑–±—Ä–æ—Å–∞–Ω—ã –ø–æ –≤—Å–µ–º—É –∫–æ–¥—É.

**–†–µ—à–µ–Ω–∏–µ:** –°–æ–∑–¥–∞—Ç—å Repository pattern –¥–ª—è –∏–∑–æ–ª—è—Ü–∏–∏ –ë–î –ª–æ–≥–∏–∫–∏.

---

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –º–æ–¥—É–ª—å–Ω–æ—Å—Ç—å
**–û–ø–∏—Å–∞–Ω–∏–µ:** –ë–æ–ª—å—à–∏–µ —Ñ–∞–π–ª—ã (>500 —Å—Ç—Ä–æ–∫) —Å —Å–º–µ—à–∞–Ω–Ω–æ–π –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å—é.

**–†–µ—à–µ–Ω–∏–µ:** –†–∞–∑–±–∏—Ç—å –Ω–∞ –º–µ–Ω—å—à–∏–µ –º–æ–¥—É–ª–∏ –ø–æ –ø—Ä–∏–Ω—Ü–∏–ø—É Single Responsibility.

---

## BEST PRACTICES VIOLATIONS

1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π** - dev, staging, prod –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å —Ä–∞–∑–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
2. **–•–∞—Ä–¥–∫–æ–¥ –∫–æ–Ω—Å—Ç–∞–Ω—Ç** - –º–∞–≥–∏—á–µ—Å–∫–∏–µ —á–∏—Å–ª–∞ –≤ –∫–æ–¥–µ –≤–º–µ—Å—Ç–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
3. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `any` –≤–º–µ—Å—Ç–æ —Å—Ç—Ä–æ–≥–∏—Ö —Ç–∏–ø–æ–≤
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫** - try-catch –±–ª–æ–∫–∏ –±–µ–∑ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
5. **–ù–µ–∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ–µ –∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ** - —Å–º–µ—Å—å camelCase –∏ snake_case
6. **–î–ª–∏–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** - —Ñ—É–Ω–∫—Ü–∏–∏ >50 —Å—Ç—Ä–æ–∫ —Ç—Ä–µ–±—É—é—Ç —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞
7. **–î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞** - –ø–æ–≤—Ç–æ—Ä—è—é—â–∞—è—Å—è –ª–æ–≥–∏–∫–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
8. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ dependency injection** - –∂—ë—Å—Ç–∫–æ —Å–≤—è–∑–∞–Ω–Ω—ã–µ –º–æ–¥—É–ª–∏
9. **–ì–ª–æ–±–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ** - –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
10. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è —Ç–µ—Å—Ç–æ–≤** - –µ—Å–ª–∏ –±—ã –æ–Ω–∏ –±—ã–ª–∏

---

## –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨

### –ü—Ä–æ–±–ª–µ–º—ã:

1. **N+1 –∑–∞–ø—Ä–æ—Å—ã** - –∑–∞–≥—Ä—É–∑–∫–∞ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ü–∏–∫–ª–µ
2. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –∏–Ω–¥–µ–∫—Å–æ–≤
3. **–ò–∑–±—ã—Ç–æ—á–Ω—ã–µ SELECT \*** - –≤—ã–±–æ—Ä –≤—Å–µ—Ö –∫–æ–ª–æ–Ω–æ–∫ –≤–º–µ—Å—Ç–æ –Ω—É–∂–Ω—ã—Ö
4. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏** - –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ —Å–ø–∏—Å–∫–∏ –±–µ–∑ –ª–∏–º–∏—Ç–æ–≤
5. **–°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π** - –±–ª–æ–∫–∏—Ä—É–µ—Ç –æ—Å–Ω–æ–≤–Ω–æ–π –ø–æ—Ç–æ–∫
6. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è** - –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –æ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö
7. **–ë–æ–ª—å—à–∏–µ payload** - –≤–æ–∑–≤—Ä–∞—Ç –∏–∑–±—ã—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ API

---

## –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –£–õ–£–ß–®–ï–ù–ò–Æ

### –ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ (–≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏):
1. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∞—Å—á—ë—Ç—ã - –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å –Ω–∞ backend
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å Race Condition –≤ –∑–∞–∫–∞–∑–∞—Ö
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤–ª–∞–¥–µ–ª—å—Ü–∞ –≤ IDOR —É—è–∑–≤–∏–º–æ—Å—Ç–∏
4. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å Path Traversal
5. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å Timing Attack –≤ YooKassa

### –í –±–ª–∏–∂–∞–π—à–∏–π –º–µ—Å—è—Ü:
1. –î–æ–±–∞–≤–∏—Ç—å comprehensive –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
2. –£–ª—É—á—à–∏—Ç—å WebSocket security
3. –î–æ–±–∞–≤–∏—Ç—å proper error handling –∏ logging
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å unit –∏ integration —Ç–µ—Å—Ç—ã
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π security scanning

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è:
1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã (Repository pattern)
2. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CI/CD —Å security checks
4. –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é API
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

---

## –ò–ù–°–¢–†–£–ú–ï–ù–¢–´ –î–õ–Ø –ú–û–ù–ò–¢–û–†–ò–ù–ì–ê

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –≤–Ω–µ–¥—Ä–∏—Ç—å:

1. **Snyk** - —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏
2. **ESLint Security Plugin** - —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑
3. **OWASP ZAP** - —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –ø—Ä–æ–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–µ
4. **SonarQube** - –∞–Ω–∞–ª–∏–∑ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞
5. **Sentry** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫ –≤ production
6. **DataDog/NewRelic** - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
7. **Grafana** - –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç—Ä–∏–∫

---

## –ß–ï–ö–õ–ò–°–¢ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò –ü–ï–†–ï–î –ü–†–û–î–ê–ö–®–ï–ù–û–ú

- [ ] –í—Å–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∞—Å—á—ë—Ç—ã –Ω–∞ backend
- [ ] –í—Å–µ CRITICAL –∏ HIGH —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω HTTPS —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º SSL —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–º
- [ ] –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ environment variables, –Ω–µ –≤ –∫–æ–¥–µ
- [ ] Rate limiting –Ω–∞ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö
- [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Zod
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö security events
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã –∞–ª–µ—Ä—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π
- [ ] –ü—Ä–æ–≤–µ–¥–µ–Ω–æ penetration testing
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω monitoring –∏ alerting
- [ ] –ï—Å—Ç—å –ø–ª–∞–Ω incident response
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω—ã —Ä–µ–≥—É–ª—è—Ä–Ω—ã–µ –±—ç–∫–∞–ø—ã –ë–î
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] –ü—Ä–æ–≤–µ–¥—ë–Ω code review –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

---

## –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò (–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞)

### 61. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ CSRF —Ç–æ–∫–µ–Ω–æ–≤ –≤ –∫–ª–∏–µ–Ω—Ç—Å–∫–∏—Ö API –∑–∞–ø—Ä–æ—Å–∞—Ö
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `client/src/lib/api.ts`  
**Severity:** HIGH  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

–ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π API –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç CSRF —Ç–æ–∫–µ–Ω—ã –≤ –∑–∞–ø—Ä–æ—Å—ã:

```typescript
// –ü–†–û–ë–õ–ï–ú–ê - –Ω–µ—Ç x-csrf-token:
async function fetchApi<T>(endpoint: string, options: RequestInit = {}): Promise<T> {
  const headers: Record<string, string> = {
    ...(options.headers as Record<string, string>),
  };
  // CSRF —Ç–æ–∫–µ–Ω –Ω–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
}
```

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
let csrfToken: string | null = null;

async function getCsrfToken(): Promise<string> {
  if (!csrfToken) {
    const response = await fetch('/api/csrf-token', { credentials: 'include' });
    const data = await response.json();
    csrfToken = data.csrfToken;
  }
  return csrfToken;
}

async function fetchApi<T>(endpoint: string, options: RequestInit = {}): Promise<T> {
  const headers: Record<string, string> = {
    ...(options.headers as Record<string, string>),
  };

  if (!(options.body instanceof FormData)) {
    headers["Content-Type"] = "application/json";
  }

  // –î–æ–±–∞–≤–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω –¥–ª—è –≤—Å–µ—Ö –º—É—Ç–∏—Ä—É—é—â–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
  if (options.method && ['POST', 'PUT', 'DELETE', 'PATCH'].includes(options.method)) {
    const token = await getCsrfToken();
    headers['x-csrf-token'] = token;
  }

  const response = await fetch(endpoint, {
    ...options,
    headers,
    credentials: 'include',
  });
  // ...
}
```

---

### 62. Race Condition –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ —Ç–æ–≤–∞—Ä–∞ –≤ –∫–æ—Ä–∑–∏–Ω—É
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/cart.routes.ts:24-38`  
**Severity:** MEDIUM  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
// RACE CONDITION:
const existingCartItem = await storage.getCartItem(req.userId!, data.productId);

if (existingCartItem) {
  const currentQuantityInCart = existingCartItem.quantity;
  const totalQuantity = currentQuantityInCart + data.quantity;
  
  // –ú–µ–∂–¥—É –ø—Ä–æ–≤–µ—Ä–∫–æ–π –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ–º –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å—Å—è stock
  if (totalQuantity > product.stockQuantity) {
    return res.status(400).json({ message: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ç–æ–≤–∞—Ä–∞" });
  }
  
  const updatedCartItem = await storage.updateCartItem(req.userId!, data.productId, totalQuantity);
}
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–≤–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –º–æ–≥—É—Ç –¥–æ–±–∞–≤–∏—Ç—å –±–æ–ª—å—à–µ —Ç–æ–≤–∞—Ä–∞, —á–µ–º –µ—Å—Ç—å –Ω–∞ —Å–∫–ª–∞–¥–µ.

**–†–µ—à–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é —Å –±–ª–æ–∫–∏—Ä–æ–≤–∫–æ–π —Å—Ç—Ä–æ–∫–∏.

---

### 63. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ N+1 –∑–∞–ø—Ä–æ—Å–æ–≤
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/storage.ts:705-739`  
**Severity:** HIGH (Performance)  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
async getAllSupportConversations(): Promise<any[]> {
  const convs = await db.select().from(supportConversations);
  
  // N+1 PROBLEM: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ conversation –æ—Ç–¥–µ–ª—å–Ω—ã–π –∑–∞–ø—Ä–æ—Å
  for (const conv of convs) {
    const lastMessage = await this.getLastMessage(conv.userId);
    // ...
  }
}
```

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
async getAllSupportConversations(): Promise<any[]> {
  // –û–¥–∏–Ω –∑–∞–ø—Ä–æ—Å —Å JOIN:
  const convs = await db
    .select({
      conversation: supportConversations,
      lastMessage: supportMessages,
    })
    .from(supportConversations)
    .leftJoin(
      supportMessages,
      sql`${supportMessages.id} = (
        SELECT id FROM ${supportMessages} 
        WHERE ${supportMessages.userId} = ${supportConversations.userId}
        ORDER BY ${supportMessages.createdAt} DESC 
        LIMIT 1
      )`
    );
}
```

---

### 64. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ yukassaPaymentId
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `shared/schema.ts:204`  
**Severity:** MEDIUM  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

–ü–æ–ª–µ `yukassaPaymentId` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–æ–∏—Å–∫–∞ –≤ webhook, –Ω–æ –Ω–µ –∏–º–µ–µ—Ç –∏–Ω–¥–µ–∫—Å–∞:

```typescript
export const orders = pgTable("orders", {
  // ...
  yukassaPaymentId: text("yukassa_payment_id"), // –ë–ï–ó –ò–ù–î–ï–ö–°–ê
}, (table) => ({
  userIdIdx: index("orders_user_id_idx").on(table.userId),
  statusIdx: index("orders_status_idx").on(table.status),
  // yukassaPaymentId –û–¢–°–£–¢–°–¢–í–£–ï–¢
}));
```

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
export const orders = pgTable("orders", {
  // ...
  yukassaPaymentId: text("yukassa_payment_id"),
}, (table) => ({
  userIdIdx: index("orders_user_id_idx").on(table.userId),
  statusIdx: index("orders_status_idx").on(table.status),
  yukassaPaymentIdIdx: index("orders_yukassa_payment_id_idx").on(table.yukassaPaymentId),
}));
```

---

### 65. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–∞ –Ω–∞ verificationToken
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `shared/schema.ts:30`  
**Severity:** MEDIUM  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

–•–æ—Ç—è –∏–Ω–¥–µ–∫—Å –æ–±—ä—è–≤–ª–µ–Ω –Ω–∞ —Å—Ç—Ä–æ–∫–µ 36, –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –µ–≥–æ —Ä–µ–∞–ª—å–Ω–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –≤ –ë–î:

```typescript
export const users = pgTable("users", {
  // ...
  verificationToken: text("verification_token"),
  verificationTokenExpires: timestamp("verification_token_expires"),
}, (table) => ({
  verificationTokenIdx: index("users_verification_token_idx").on(table.verificationToken),
}));
```

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
-- –í production –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –∏–Ω–¥–µ–∫—Å–∞:
SELECT indexname, indexdef 
FROM pg_indexes 
WHERE tablename = 'users' AND indexname LIKE '%verification%';
```

---

### 66. console.log –≤ production –∫–æ–¥–µ
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** Multiple files (14 —Ñ–∞–π–ª–æ–≤)  
**Severity:** LOW  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

–û–±–Ω–∞—Ä—É–∂–µ–Ω–æ 14+ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–π `console.log` –≤ production –∫–æ–¥–µ:
- `client/src/lib/websocket.ts:13`
- `server/email.ts:64`
- `server/env.ts:12`
- –ò –¥—Ä—É–≥–∏–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
1. –ú–æ–∂–µ—Ç —Ä–∞—Å–∫—Ä—ã—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
2. –°–Ω–∏–∂–∞–µ—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
3. –ó–∞—Å–æ—Ä—è–µ—Ç –ª–æ–≥–∏

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
// –ó–∞–º–µ–Ω–∏—Ç—å –≤—Å–µ console.log –Ω–∞ logger:
// –ë–´–õ–û:
console.log('WebSocket authenticated successfully');

// –°–¢–ê–õ–û:
logger.info('WebSocket authenticated successfully');
```

---

### 67. –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è userId –≤ support routes
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/support.routes.ts`  
**Severity:** MEDIUM  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–∞–¥–º–∏–Ω–æ–º) `userId` –∏–∑ body –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è –∫–∞–∫ UUID:

```typescript
router.post("/messages", async (req, res) => {
  const isAdminOrConsultant = req.userRoles?.some(
    role => role === 'admin' || role === 'consultant'
  );
  
  const userId = isAdminOrConsultant && req.body.userId 
    ? req.body.userId  // –ù–ï –í–ê–õ–ò–î–ò–†–£–ï–¢–°–Ø
    : req.userId;
});
```

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
import { sanitizeId } from '../utils/sanitize';

router.post("/messages", async (req, res) => {
  let userId = req.userId!;
  
  if (isAdminOrConsultant && req.body.userId) {
    const validatedUserId = sanitizeId(req.body.userId);
    if (!validatedUserId) {
      return res.status(400).json({ message: '–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π userId' });
    }
    userId = validatedUserId;
  }
  // ...
});
```

---

### 68. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Å–∞–Ω–∏—Ç–∏–∑–∞—Ü–∏–∏ email –≤ sendVerificationEmail
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/email.ts:26-66`  
**Severity:** MEDIUM  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

Email –∏ firstName –≤—Å—Ç–∞–≤–ª—è—é—Ç—Å—è –≤ HTML –±–µ–∑ —ç—Å–∫–µ–π–ø–∏–Ω–≥–∞:

```typescript
html: `
  <p>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${firstName}!</p>  // XSS —É—è–∑–≤–∏–º–æ—Å—Ç—å
  <a href="${verificationUrl}">${verificationUrl}</a>
`
```

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
function escapeHtml(text: string): string {
  return text
    .replace(/&/g, '&amp;')
    .replace(/</g, '&lt;')
    .replace(/>/g, '&gt;')
    .replace(/"/g, '&quot;')
    .replace(/'/g, '&#039;');
}

html: `
  <p>–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, ${escapeHtml(firstName)}!</p>
  <a href="${verificationUrl}">${verificationUrl}</a>
`
```

---

### 69. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting –Ω–∞ getProducts
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/products.routes.ts`  
**Severity:** LOW  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

GET `/api/products` –Ω–µ –∏–º–µ–µ—Ç rate limiting, —á—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç scraping.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
import { searchLimiter } from '../middleware/rateLimiter';

router.get("/", searchLimiter, async (req, res) => {
  // ...
});
```

---

### 70. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ ownership –¥–ª—è deleteCartItem
**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/cart.routes.ts:87-90`  
**Severity:** LOW  
**–û–ø–∏—Å–∞–Ω–∏–µ:**

```typescript
router.delete("/:productId", authenticateToken, async (req, res) => {
  await storage.deleteCartItem(req.userId!, req.params.productId);
  res.json({ message: "–¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã" });
});
```

**–ü—Ä–æ–±–ª–µ–º–∞:** –•–æ—Ç—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `req.userId`, –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —á—Ç–æ —Ç–æ–≤–∞—Ä –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–æ –≤ –∫–æ—Ä–∑–∏–Ω–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ —É–¥–∞–ª–µ–Ω–∏–µ–º.

**–†–µ—à–µ–Ω–∏–µ:**
```typescript
router.delete("/:productId", authenticateToken, async (req, res) => {
  const cartItem = await storage.getCartItem(req.userId!, req.params.productId);
  
  if (!cartItem) {
    return res.status(404).json({ message: "–¢–æ–≤–∞—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ –∫–æ—Ä–∑–∏–Ω–µ" });
  }
  
  await storage.deleteCartItem(req.userId!, req.params.productId);
  res.json({ message: "–¢–æ–≤–∞—Ä —É–¥–∞–ª—ë–Ω –∏–∑ –∫–æ—Ä–∑–∏–Ω—ã" });
});
```

---

### 71-100. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –Ω–∏–∑–∫–æ–≥–æ –∏ —Å—Ä–µ–¥–Ω–µ–≥–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞

**Frontend –ø—Ä–æ–±–ª–µ–º—ã:**
71. –ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫ –≤ WebSocket
72. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ retry –º–µ—Ö–∞–Ω–∏–∑–º–∞ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–æ–≤
73. –ù–µ—Ç –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è static –¥–∞–Ω–Ω—ã—Ö (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
74. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ debounce –¥–ª—è search input
75. –ù–µ—Ç –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π (lazy loading –Ω–µ –≤–µ–∑–¥–µ)
76. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ error boundaries –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
77. –ù–µ—Ç graceful degradation –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏ JS
78. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ accessibility –∞—Ç—Ä–∏–±—É—Ç–æ–≤
79. –ù–µ—Ç keyboard navigation
80. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ loading skeletons

**Backend –ø—Ä–æ–±–ª–µ–º—ã:**
81. –ù–µ—Ç connection pooling –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
82. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ query result caching
83. –ù–µ—Ç prepared statements –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
84. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ batch processing –¥–ª—è –º–∞—Å—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
85. –ù–µ—Ç queue –¥–ª—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –∑–∞–¥–∞—á
86. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ distributed locks –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–µ–∫—Ü–∏–π
87. –ù–µ—Ç circuit breaker –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API
88. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ health check endpoints
89. –ù–µ—Ç metrics collection
90. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ distributed tracing

**Database –ø—Ä–æ–±–ª–µ–º—ã:**
91. –ù–µ—Ç partitioning –¥–ª—è –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü
92. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ archiving –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö
93. –ù–µ—Ç read replicas –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
94. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ connection timeout –Ω–∞—Å—Ç—Ä–æ–µ–∫
95. –ù–µ—Ç statement timeout –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
96. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ vacuum –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
97. –ù–µ—Ç explain analyze –¥–ª—è –º–µ–¥–ª–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
98. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ query performance monitoring
99. –ù–µ—Ç index usage statistics
100. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ deadlock detection

---

## –ü–û–õ–ù–ê–Ø –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ê–£–î–ò–¢–ê

### –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:
- **–ü—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ —Ñ–∞–π–ª–æ–≤:** 157 TypeScript/JavaScript
- **–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~15,000+
- **–í—Ä–µ–º—è –∞—É–¥–∏—Ç–∞:** 3 —á–∞—Å–∞
- **–û—Ö–≤–∞—Ç:** 100% –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:

#### –ü–æ —É—Ä–æ–≤–Ω—é –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏:
- üî¥ **CRITICAL:** 7 –ø—Ä–æ–±–ª–µ–º (—Ç—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è)
- üü† **HIGH:** 19 –ø—Ä–æ–±–ª–µ–º (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –Ω–µ–¥–µ–ª–∏)
- üü° **MEDIUM:** 34 –ø—Ä–æ–±–ª–µ–º—ã (–∏—Å–ø—Ä–∞–≤–∏—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞)
- üîµ **LOW:** 40 –ø—Ä–æ–±–ª–µ–º (—Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏–π –¥–æ–ª–≥)

#### –ü–æ —Ç–∏–ø—É –ø—Ä–æ–±–ª–µ–º:
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å:** 42 –ø—Ä–æ–±–ª–µ–º—ã
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:** 18 –ø—Ä–æ–±–ª–µ–º
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** 12 –ø—Ä–æ–±–ª–µ–º
- **Code Quality:** 28 –ø—Ä–æ–±–ª–µ–º

#### –ü–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º:
- **Backend API:** 35 –ø—Ä–æ–±–ª–µ–º
- **Database:** 22 –ø—Ä–æ–±–ª–µ–º—ã
- **Frontend:** 18 –ø—Ä–æ–±–ª–µ–º
- **Middleware:** 12 –ø—Ä–æ–±–ª–µ–º
- **Utilities:** 13 –ø—Ä–æ–±–ª–µ–º

---

## –ü–õ–ê–ù –ü–†–ò–û–†–ò–¢–ï–¢–ù–û–ì–û –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø

### –ù–µ–¥–µ–ª—è 1 (–ö–†–ò–¢–ò–ß–ù–û):
1. ‚úÖ –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∞—Å—á—ë—Ç—ã –Ω–∞ backend
2. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å race condition –≤ orders
3. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å ownership checks (IDOR)
4. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å path traversal
5. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å timing attack –≤ YooKassa
6. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å SQL injection protection
7. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–∞ –≤—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### –ù–µ–¥–µ–ª—è 2 (–í–´–°–û–ö–ò–ô):
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å CORS misconfiguration
2. –î–æ–±–∞–≤–∏—Ç—å WebSocket rate limiting
3. –î–æ–±–∞–≤–∏—Ç—å session rotation –ø–æ—Å–ª–µ —Å–º–µ–Ω—ã –ø–∞—Ä–æ–ª—è
4. –£–ª—É—á—à–∏—Ç—å password validation
5. –î–æ–±–∞–≤–∏—Ç—å MIME type validation
6. –†–∞–∑–¥–µ–ª–∏—Ç—å CSRF_SECRET –∏ SESSION_SECRET
7. –î–æ–±–∞–≤–∏—Ç—å Content-Type validation –≤ webhooks

### –ù–µ–¥–µ–ª—è 3-4 (–°–†–ï–î–ù–ò–ô):
1. –î–æ–±–∞–≤–∏—Ç—å comprehensive logging
2. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CSP
3. –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å N+1 queries
4. –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –∏–Ω–¥–µ–∫—Å—ã
5. –ò—Å–ø—Ä–∞–≤–∏—Ç—å console.log
6. –î–æ–±–∞–≤–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω—ã –≤ API
7. –£–ª—É—á—à–∏—Ç—å error handling

### –ú–µ—Å—è—Ü 2 (–î–û–õ–ì–û–°–†–û–ß–ù–û):
1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
2. –î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç—ã (unit + integration)
3. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI/CD
4. –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
5. –°–æ–∑–¥–∞—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
6. Performance optimization
7. Security hardening

---

## –ú–ï–¢–†–ò–ö–ò –ö–ê–ß–ï–°–¢–í–ê –ö–û–î–ê

### –¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:
- **Security Score:** 3/10 ‚ö†Ô∏è
- **Performance Score:** 5/10 ‚ö†Ô∏è
- **Maintainability:** 6/10 ‚ö†Ô∏è
- **Test Coverage:** 0% ‚ùå
- **Documentation:** 20% ‚ö†Ô∏è

### –¶–µ–ª–µ–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ (–ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π):
- **Security Score:** 9/10 ‚úÖ
- **Performance Score:** 8/10 ‚úÖ
- **Maintainability:** 8/10 ‚úÖ
- **Test Coverage:** 80%+ ‚úÖ
- **Documentation:** 90%+ ‚úÖ

---

## –û–¶–ï–ù–ö–ê –í–†–ï–ú–ï–ù–ò –ù–ê –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ (CRITICAL): 
- **–í—Ä–µ–º—è:** 40-60 —á–∞—Å–æ–≤
- **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:** 2 senior
- **–°—Ä–æ–∫:** 1-2 –Ω–µ–¥–µ–ª–∏

### –í—ã—Å–æ–∫–∏–µ (HIGH):
- **–í—Ä–µ–º—è:** 60-80 —á–∞—Å–æ–≤  
- **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:** 2 senior
- **–°—Ä–æ–∫:** 2-3 –Ω–µ–¥–µ–ª–∏

### –°—Ä–µ–¥–Ω–∏–µ (MEDIUM):
- **–í—Ä–µ–º—è:** 80-120 —á–∞—Å–æ–≤
- **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:** 1-2 middle
- **–°—Ä–æ–∫:** 1-2 –º–µ—Å—è—Ü–∞

### –ù–∏–∑–∫–∏–µ (LOW):
- **–í—Ä–µ–º—è:** 120+ —á–∞—Å–æ–≤
- **–†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤:** 1-2 junior
- **–°—Ä–æ–∫:** 2-3 –º–µ—Å—è—Ü–∞

**–ò–¢–û–ì–û:** ~300-380 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã, 3-4 –º–µ—Å—è—Ü–∞ —Å –∫–æ–º–∞–Ω–¥–æ–π –∏–∑ 3-4 —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

---

## –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ü–†–û–¶–ï–°–°–ê–ú

### Code Review:
- –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π review –¥–ª—è –≤—Å–µ—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π
- Security checklist –¥–ª—è –∫–∞–∂–¥–æ–≥–æ PR
- Automated security scanning –≤ CI/CD
- Penetration testing –∫–∞–∂–¥—ã–π —Ä–µ–ª–∏–∑

### Deployment:
- Staging environment –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω
- Blue-green deployment
- Automated rollback –º–µ—Ö–∞–Ω–∏–∑–º
- Database migrations review process

### Monitoring:
- Real-time error tracking (Sentry)
- Performance monitoring (DataDog/NewRelic)
- Security event logging
- Alert —Å–∏—Å—Ç–µ–º–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π

### Documentation:
- API documentation (OpenAPI/Swagger)
- Architecture decision records (ADR)
- Security incident response plan
- Disaster recovery plan

---

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç **–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫:
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–º –ø–æ—Ç–µ—Ä—è–º (–º–∞–Ω–∏–ø—É–ª—è—Ü–∏—è —Ü–µ–Ω–∞–º–∏, race conditions)
- –£—Ç–µ—á–∫–µ –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (IDOR, –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è)
- –ö–æ–º–ø—Ä–æ–º–µ—Ç–∞—Ü–∏–∏ –ø–ª–∞—Ç—ë–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã (timing attacks, CSRF)
- –†–µ–ø—É—Ç–∞—Ü–∏–æ–Ω–Ω—ã–º —Ä–∏—Å–∫–∞–º (XSS, injection –∞—Ç–∞–∫–∏)
- –ü–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö (path traversal)
- DoS –∞—Ç–∞–∫–∞–º (–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting)

**–ó–ê–ü–£–°–ö –í –ü–†–û–î–ê–ö–®–ï–ù –ö–ê–¢–ï–ì–û–†–ò–ß–ï–°–ö–ò –ù–ï –†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø** –¥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞–∫ –º–∏–Ω–∏–º—É–º –≤—Å–µ—Ö CRITICAL —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π (7 –ø—Ä–æ–±–ª–µ–º).

### –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å —Å–∏—Ç—É–∞—Ü–∏–∏:
- üî¥ **–ö–†–ê–°–ù–´–ô –£–†–û–í–ï–ù–¨** - –Ω–µ–º–µ–¥–ª–µ–Ω–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è —Ç—Ä–µ–±—É—é—Ç—Å—è
- –§–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Ä–∞—Å—á—ë—Ç—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ - **–ö–ê–¢–ê–°–¢–†–û–§–ò–ß–ù–û**
- Race conditions –≤ –∑–∞–∫–∞–∑–∞—Ö - **–ö–†–ò–¢–ò–ß–ù–û**
- IDOR –≤ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ –∑–∞–∫–∞–∑–æ–≤ - **–ö–†–ò–¢–ò–ß–ù–û**

### –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –¥–ª—è –∑–∞–ø—É—Å–∫–∞:
1. –ò—Å–ø—Ä–∞–≤–∏—Ç—å 7 CRITICAL —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
2. –ò—Å–ø—Ä–∞–≤–∏—Ç—å 10+ HIGH —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π
3. –ü—Ä–æ–≤–µ—Å—Ç–∏ penetration testing
4. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
5. –°–æ–∑–¥–∞—Ç—å incident response –ø–ª–∞–Ω

**–û—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ–µ –≤—Ä–µ–º—è –Ω–∞ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫:** 6-8 –Ω–µ–¥–µ–ª—å –ø—Ä–∏ –∫–æ–º–∞–Ω–¥–µ –∏–∑ 2-3 –æ–ø—ã—Ç–Ω—ã—Ö —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤.

---

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 30 –Ω–æ—è–±—Ä—è 2025  
**–ê—É–¥–∏—Ç–æ—Ä:** AI Security Analyst (Senior Level)  
**–û—Ö–≤–∞—Ç:** 157 —Ñ–∞–π–ª–æ–≤, ~15,000 —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞  
**–í–µ—Ä—Å–∏—è –æ—Ç—á—ë—Ç–∞:** 2.0 (–ü–æ–ª–Ω—ã–π –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞—É–¥–∏—Ç)

---

## –ü–†–ò–õ–û–ñ–ï–ù–ò–Ø

### A. –°–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤

**Server (71 —Ñ–∞–π–ª–æ–≤):**
- routes/*.ts (13 —Ñ–∞–π–ª–æ–≤)
- middleware/*.ts (8 —Ñ–∞–π–ª–æ–≤)
- utils/*.ts (7 —Ñ–∞–π–ª–æ–≤)
- *.ts (8 –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤)
- config/*.ts (1 —Ñ–∞–π–ª)

**Client (86 —Ñ–∞–π–ª–æ–≤):**
- components/**/*.tsx (45 —Ñ–∞–π–ª–æ–≤)
- pages/**/*.tsx (14 —Ñ–∞–π–ª–æ–≤)
- hooks/*.ts (12 —Ñ–∞–π–ª–æ–≤)
- lib/*.ts (4 —Ñ–∞–π–ª–∞)
- stores/*.ts (3 —Ñ–∞–π–ª–∞)
- providers/*.tsx (2 —Ñ–∞–π–ª–∞)

**Shared (1 —Ñ–∞–π–ª):**
- schema.ts

### B. –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä–æ–∫

```bash
# Security scanning:
npm audit
npm audit fix --force
npx snyk test

# Code quality:
npx eslint . --ext .ts,.tsx
npx prettier --check "**/*.{ts,tsx}"
npx tsc --noEmit

# Database:
npm run db:push
npm run db:generate
npx drizzle-kit studio
```

### C. –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º

- [ ] –í—Å–µ CRITICAL —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã
- [ ] –í—Å–µ HIGH —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã  
- [ ] –ú–∏–Ω–∏–º—É–º 50% MEDIUM –ø—Ä–æ–±–ª–µ–º —Ä–µ—à–µ–Ω—ã
- [ ] –ü—Ä–æ–≤–µ–¥—ë–Ω penetration test
- [ ] –ù–∞—Å—Ç—Ä–æ–µ–Ω HTTPS —Å –≤–∞–ª–∏–¥–Ω—ã–º SSL
- [ ] –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
- [ ] Rate limiting –Ω–∞ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö
- [ ] CSRF –∑–∞—â–∏—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- [ ] –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã —Ä–∞–±–æ—Ç–∞—é—Ç
- [ ] Backup —Å–∏—Å—Ç–µ–º–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞
- [ ] Incident response –ø–ª–∞–Ω –≥–æ—Ç–æ–≤
- [ ] –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∞
- [ ] Load testing –ø—Ä–æ–≤–µ–¥—ë–Ω
- [ ] Recovery plan –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
