# –ê–£–î–ò–¢ –ö–û–î–ê –ü–†–û–ï–ö–¢–ê E-COMMERCE

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 29 –Ω–æ—è–±—Ä—è 2025  
**–¢–∏–ø –ø—Ä–æ–≤–µ—Ä–∫–∏:** –ü–æ–ª–Ω—ã–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑  
**–í–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞:** 1.0.0  
**–°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π:** React + Vite (Frontend), Express + PostgreSQL (Backend), Drizzle ORM

---

## EXECUTIVE SUMMARY

–ü—Ä–æ–≤–µ–¥–µ–Ω –≤—Å–µ—Å—Ç–æ—Ä–æ–Ω–Ω–∏–π –∞—É–¥–∏—Ç –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ e-commerce –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è. –ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–æ–π –ø—Ä–æ–¥—É–º–∞–Ω–Ω–æ—Å—Ç–∏, –æ–¥–Ω–∞–∫–æ –≤—ã—è–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏ –Ω–µ–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:** 7.5/10  
**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∫–∞—á–µ—Å—Ç–≤–∞ –∫–æ–¥–∞:** 8/10  
**–û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:** 8.5/10

---

## 1. –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò –ò –ü–†–û–ë–õ–ï–ú–´

### 1.1 ‚ùå CRITICAL: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å—ã—Ä—ã—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ (SQL Injection Risk)

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:**
- `server/routes/admin.routes.ts` (—Å—Ç—Ä–æ–∫–∏ 18-22)
- `server/routes/orders.routes.ts` (—Å—Ç—Ä–æ–∫–∏ 149-156, 171-178, 196-200)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// –ü—Ä–∏–º–µ—Ä –∏–∑ admin.routes.ts
db.execute(sql`SELECT COUNT(*)::int as count FROM users`)

// –ü—Ä–∏–º–µ—Ä –∏–∑ orders.routes.ts  
await tx.execute(
  sql`UPDATE products 
      SET stock_quantity = stock_quantity - ${item.quantity},
          updated_at = NOW()
      WHERE id = ${item.productId}
        AND stock_quantity >= ${item.quantity}`
)
```

–•–æ—Ç—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è tagged template literals Drizzle, —á—Ç–æ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –±–∞–∑–æ–≤—É—é –∑–∞—â–∏—Ç—É –æ—Ç SQL-–∏–Ω—ä–µ–∫—Ü–∏–π —á–µ—Ä–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—é, —Å–º–µ—à–∏–≤–∞–Ω–∏–µ —Å—ã—Ä–æ–≥–æ SQL —Å ORM-–∑–∞–ø—Ä–æ—Å–∞–º–∏ —Å–æ–∑–¥–∞–µ—Ç —Ä–∏—Å–∫–∏:
- –°–Ω–∏–∂–µ–Ω–∏–µ —á–∏—Ç–∞–µ–º–æ—Å—Ç–∏ –∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏ –∫–æ–¥–∞
- –ü–æ—Ç–µ—Ä—è type-safety –ø—Ä–µ–∏–º—É—â–µ—Å—Ç–≤ Drizzle ORM
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –ø—Ä–∏ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –≤ –±—É–¥—É—â–µ–º

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –≤—Å–µ—Ö —Å—ã—Ä—ã—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ Drizzle Query Builder:
```typescript
// –í–º–µ—Å—Ç–æ —Å—ã—Ä–æ–≥–æ SQL
const totalUsers = await db.execute(sql`SELECT COUNT(*)::int as count FROM users`);

// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Drizzle Builder
import { count } from 'drizzle-orm';
const totalUsers = await db.select({ count: count() }).from(users);
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

---

### 1.2 ‚ùå CRITICAL: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ä–µ—Å—É—Ä—Å–∞ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** 
- `server/routes/addresses.routes.ts`
- `server/routes/payment-cards.routes.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∏ —É–¥–∞–ª–µ–Ω–∏—è –∞–¥—Ä–µ—Å–æ–≤/–∫–∞—Ä—Ç –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç middleware –ø—Ä–æ–≤–µ—Ä–∫–∏, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –≤–ª–∞–¥–µ–ª—å—Ü–µ–º —Ä–µ—Å—É—Ä—Å–∞. –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –≤–æ–∑–º–æ–∂–Ω–∞ —Å–∏—Ç—É–∞—Ü–∏—è IDOR (Insecure Direct Object Reference).

**–ü—Ä–∏–º–µ—Ä —É—è–∑–≤–∏–º–æ–≥–æ –∫–æ–¥–∞:**
```typescript
router.delete("/:id", authenticateToken, async (req, res) => {
  await storage.deleteUserAddress(req.params.id);
  // ‚ùå –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏: –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–∏—Ç –ª–∏ –∞–¥—Ä–µ—Å req.userId
});
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å middleware `resourceOwnership` –∏–ª–∏ —è–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É:
```typescript
router.delete("/:id", authenticateToken, async (req, res) => {
  const address = await storage.getUserAddress(req.params.id);
  if (!address || address.userId !== req.userId) {
    return res.status(403).json({ message: "–î–æ—Å—Ç—É–ø –∑–∞–ø—Ä–µ—â—ë–Ω" });
  }
  await storage.deleteUserAddress(req.params.id);
});
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0 (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ)

---

### 1.3 ‚ö†Ô∏è HIGH: –£—è–∑–≤–∏–º–æ—Å—Ç—å Race Condition –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/orders.routes.ts` (—Å—Ç—Ä–æ–∫–∏ 148-168)

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –æ—Å—Ç–∞—Ç–∫–æ–≤ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —á–µ—Ä–µ–∑ UPDATE —Å WHERE —É—Å–ª–æ–≤–∏–µ–º, –Ω–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö (SELECT FOR UPDATE). –î–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–∫–∞–∑–∞ –º–æ–≥—É—Ç –æ–±–Ω–æ–≤–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏, –ø—Ä–µ–≤—ã—Å–∏–≤ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ.

**–°—Ü–µ–Ω–∞—Ä–∏–π –∞—Ç–∞–∫–∏:**
1. –¢–æ–≤–∞—Ä –∏–º–µ–µ—Ç stockQuantity = 1
2. –î–≤–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Å–æ–∑–¥–∞—é—Ç –∑–∞–∫–∞–∑ –Ω–∞ 1 –µ–¥–∏–Ω–∏—Ü—É
3. –û–±–∞ –∑–∞–ø—Ä–æ—Å–∞ –ø—Ä–æ—Ö–æ–¥—è—Ç –ø—Ä–æ–≤–µ—Ä–∫—É `stock_quantity >= ${item.quantity}`
4. –û–±–∞ —É–º–µ–Ω—å—à–∞—é—Ç –æ—Å—Ç–∞—Ç–æ–∫, –∏—Ç–æ–≥–æ–≤—ã–π stockQuantity = -1

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å pessimistic locking:
```typescript
// –°–Ω–∞—á–∞–ª–∞ –±–ª–æ–∫–∏—Ä—É–µ–º —Å—Ç—Ä–æ–∫—É
const [product] = await tx
  .select()
  .from(products)
  .where(eq(products.id, item.productId))
  .for('update'); // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —Å—Ç—Ä–æ–∫–∏

if (!product || product.stockQuantity < item.quantity) {
  throw new Error('INSUFFICIENT_STOCK');
}

// –ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—è–µ–º
await tx
  .update(products)
  .set({ stockQuantity: sql`stock_quantity - ${item.quantity}` })
  .where(eq(products.id, item.productId));
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0

---

### 1.4 ‚ö†Ô∏è HIGH: Email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç–æ–∫–µ–Ω–∞

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/auth.routes.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ email-–≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏. –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –ø–æ–ª—É—á–∏–ª –ø–∏—Å—å–º–æ –∏–ª–∏ –∏—Å—Ç–µ–∫ —Ç–æ–∫–µ–Ω (24 —á–∞—Å–∞), –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å email –∏ –æ—Å—Ç–∞–µ—Ç—Å—è —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å —ç–Ω–¥–ø–æ–∏–Ω—Ç `/api/auth/resend-verification`:
```typescript
router.post("/resend-verification", authenticateToken, async (req, res) => {
  const user = await storage.getUser(req.userId!);
  
  if (user.isVerified) {
    return res.status(400).json({ message: "Email —É–∂–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω" });
  }
  
  const verificationToken = generateVerificationToken();
  const verificationTokenExpires = new Date(Date.now() + 24 * 60 * 60 * 1000);
  
  await storage.updateUser(user.id, { verificationToken, verificationTokenExpires });
  await sendVerificationEmail(user.email, verificationToken, user.firstName);
  
  res.json({ message: "–ü–∏—Å—å–º–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ –ø–æ–≤—Ç–æ—Ä–Ω–æ" });
});
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1

---

## 2. –ü–†–û–ë–õ–ï–ú–´ –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò (–°–†–ï–î–ù–Ø–Ø –ö–†–ò–¢–ò–ß–ù–û–°–¢–¨)

### 2.1 ‚ö†Ô∏è MEDIUM: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø–∞—Ä–æ–ª—è

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `shared/schema.ts`, `server/utils/sanitize.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–§—É–Ω–∫—Ü–∏—è `validatePasswordStrength` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø—Ä–∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏. –¢–µ–∫—É—â–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç —Ç–æ–ª—å–∫–æ 8 —Å–∏–º–≤–æ–ª–æ–≤.

**–¢–µ–∫—É—â–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è:**
```typescript
passwordHash: z.string().min(8, "–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –Ω–µ –º–µ–Ω–µ–µ 8 —Å–∏–º–≤–æ–ª–æ–≤")
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
password: z.string()
  .min(8, "–ú–∏–Ω–∏–º—É–º 8 —Å–∏–º–≤–æ–ª–æ–≤")
  .regex(/[a-z]/, "–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Å—Ç—Ä–æ—á–Ω–∞—è –±—É–∫–≤–∞")
  .regex(/[A-Z]/, "–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–≥–ª–∞–≤–Ω–∞—è –±—É–∫–≤–∞")
  .regex(/\d/, "–î–æ–ª–∂–Ω–∞ –±—ã—Ç—å —Ü–∏—Ñ—Ä–∞")
  .regex(/[@$!%*?&]/, "–î–æ–ª–∂–µ–Ω –±—ã—Ç—å —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª"),
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1

---

### 2.2 ‚ö†Ô∏è MEDIUM: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç Timing Attacks –≤ –ø—Ä–æ–º–æ–∫–æ–¥–∞—Ö

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/orders.routes.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏—è —Å—Ç—Ä–æ–∫, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ timing attack –¥–ª—è –ø–æ–¥–±–æ—Ä–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å constant-time —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ:
```typescript
import crypto from 'crypto';

function safeCompare(a: string, b: string): boolean {
  const bufA = Buffer.from(a);
  const bufB = Buffer.from(b);
  
  if (bufA.length !== bufB.length) {
    return false;
  }
  
  return crypto.timingSafeEqual(bufA, bufB);
}
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2

---

### 2.3 ‚ö†Ô∏è MEDIUM: CORS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π –≤ production

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/middleware/cors.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
origin: isProduction
  ? (origin, callback) => {
      const allowedOrigins = [
        process.env.FRONTEND_URL,
        process.env.REPLIT_DEV_DOMAIN
      ].filter(Boolean);
      
      if (!origin || allowedOrigins.includes(origin)) {
        callback(null, true);
      }
    }
  : true
```

–£—Å–ª–æ–≤–∏–µ `!origin` —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Origin (–Ω–∞–ø—Ä–∏–º–µ—Ä, curl, Postman), —á—Ç–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–æ –¥–ª—è –æ–±—Ö–æ–¥–∞ CORS.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
if (!origin) {
  // –í production –∑–∞–ø—Ä–µ—â–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ Origin
  if (isProduction) {
    return callback(new Error('Not allowed by CORS'));
  }
  return callback(null, true);
}
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1

---

### 2.4 ‚ö†Ô∏è MEDIUM: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ü–æ –≤—Å–µ–º—É –ø—Ä–æ–µ–∫—Ç—É

**–ü—Ä–æ–±–ª–µ–º–∞:**
–•–æ—Ç—è –µ—Å—Ç—å `securityLogger.ts`, –æ–Ω –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–≥–∏–Ω–æ–≤ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π. –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ:
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö –Ω–µ—É–¥–∞—á–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
- –ü–æ–ø—ã—Ç–æ–∫ –¥–æ—Å—Ç—É–ø–∞ –∫ —á—É–∂–∏–º —Ä–µ—Å—É—Ä—Å–∞–º (IDOR attempts)
- –ê–Ω–æ–º–∞–ª—å–Ω–æ –±–æ–ª—å—à–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–ø—Ä–æ—Å–æ–≤ –æ—Ç –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–†–∞—Å—à–∏—Ä–∏—Ç—å security logging –∏ –¥–æ–±–∞–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –æ–ø–æ–≤–µ—â–µ–Ω–∏–π –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–≤.

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2

---

## 3. –ü–†–û–ë–õ–ï–ú–´ –ê–†–•–ò–¢–ï–ö–¢–£–†–´ –ò –ö–ê–ß–ï–°–¢–í–ê –ö–û–î–ê

### 3.1 üîß MEDIUM: –°–º–µ—à–∏–≤–∞–Ω–∏–µ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ —Å —Ä–æ—É—Ç–∞–º–∏

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/orders.routes.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç ~300 —Å—Ç—Ä–æ–∫ —Å–ª–æ–∂–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –ø—Ä—è–º–æ –≤ —Ä–æ—É—Ç–µ. –≠—Ç–æ –Ω–∞—Ä—É—à–∞–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø Single Responsibility –∏ –∑–∞—Ç—Ä—É–¥–Ω—è–µ—Ç —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–í—ã–Ω–µ—Å—Ç–∏ –ª–æ–≥–∏–∫—É –≤ –æ—Ç–¥–µ–ª—å–Ω—ã–π —Å–µ—Ä–≤–∏—Å–Ω—ã–π —Å–ª–æ–π:
```
server/
  services/
    OrderService.ts
    PromocodeService.ts
    InventoryService.ts
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2

---

### 3.2 üîß MEDIUM: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ unit –∏ integration —Ç–µ—Å—Ç–æ–≤

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í –ø—Ä–æ–µ–∫—Ç–µ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç —Ç–µ—Å—Ç—ã. –≠—Ç–æ –∫—Ä–∏—Ç–∏—á–Ω–æ –¥–ª—è e-commerce –ø—Ä–æ–µ–∫—Ç–∞, –≥–¥–µ –æ—à–∏–±–∫–∏ –≤ —Ä–∞—Å—á–µ—Ç–∞—Ö –º–æ–≥—É—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –ø–æ—Ç–µ—Ä—è–º.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–æ–≤–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ:
- Unit —Ç–µ—Å—Ç—ã –¥–ª—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ (promocodes, bonuses, calculations)
- Integration —Ç–µ—Å—Ç—ã –¥–ª—è API endpoints
- E2E —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ñ–ª–æ—É (checkout, payment)

–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Å—Ç–µ–∫: Vitest + Supertest

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0

---

### 3.3 üîß LOW: –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/utils/sanitize.ts` –∏ `shared/schema.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í–∞–ª–∏–¥–∞—Ü–∏—è email, —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –∏ –¥—Ä—É–≥–∏—Ö –ø–æ–ª–µ–π –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è –≤ –¥–≤—É—Ö –º–µ—Å—Ç–∞—Ö. –≠—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –ø—Ä–∞–≤–∏–ª.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã - Zod —Å—Ö–µ–º—ã –∏–∑ `shared/schema.ts`.

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P3

---

### 3.4 üîß LOW: Magic Numbers –≤ –∫–æ–¥–µ

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

**–ü—Ä–∏–º–µ—Ä—ã:**
```typescript
maxAge: 30 * 24 * 60 * 60 * 1000  // session.ts
windowMs: 15 * 60 * 1000          // rateLimiter.ts
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–í—ã–Ω–µ—Å—Ç–∏ –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã:
```typescript
export const SESSION_CONFIG = {
  MAX_AGE_MS: 30 * 24 * 60 * 60 * 1000,
  COOKIE_NAME: 'sessionId',
} as const;
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P3

---

## 4. –ü–†–û–ò–ó–í–û–î–ò–¢–ï–õ–¨–ù–û–°–¢–¨ –ò –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–Ø

### 4.1 üöÄ MEDIUM: N+1 Query Problem

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/admin.routes.ts` (—Å—Ç—Ä–æ–∫–∏ 40-58)

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
const users = await storage.getUsers();
const allRoles = await db.select().from(userRoles);
```

–ó–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –≤—Å–µ —Ä–æ–ª–∏ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ç—ã—Å—è—á–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å JOIN –∏–ª–∏ Drizzle relations:
```typescript
const usersWithRoles = await db.query.users.findMany({
  with: {
    roles: true,
  },
});
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2

---

### 4.2 üöÄ LOW: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–Ω–¥–µ–∫—Å–æ–≤ –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –ø–æ–ª—è—Ö

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `shared/schema.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–•–æ—Ç—è –º–Ω–æ–≥–∏–µ –∏–Ω–¥–µ–∫—Å—ã –µ—Å—Ç—å, –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç composite –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤:
- `orders` –ø–æ `(userId, status, createdAt)` - —á–∞—Å—Ç—ã–π —Ñ–∏–ª—å—Ç—Ä
- `products` –ø–æ `(categoryId, isArchived, price)` - –∫–∞—Ç–∞–ª–æ–≥ —Å —Ñ–∏–ª—å—Ç—Ä–∞–º–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å composite –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è —Å–ª–æ–∂–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤.

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P3

---

### 4.3 üöÄ LOW: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∏ –ø–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –∑–∞–ø—Ä–∞—à–∏–≤–∞—é—Ç—Å—è –∏–∑ –ë–î –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ, —Ö–æ—Ç—è –º–µ–Ω—è—é—Ç—Å—è —Ä–µ–¥–∫–æ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–í–Ω–µ–¥—Ä–∏—Ç—å Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è:
- –°–ø–∏—Å–æ–∫ –∫–∞—Ç–µ–≥–æ—Ä–∏–π (TTL: 1 —á–∞—Å)
- –ü–æ–ø—É–ª—è—Ä–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã (TTL: 15 –º–∏–Ω—É—Ç)
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (TTL: 5 –º–∏–Ω—É—Ç)

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P3

---

## 5. –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨ –î–ê–ù–ù–´–• –ò –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–¨

### 5.1 ‚úÖ –•–û–†–û–®–û: –•—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/auth.ts`

**–û—Ü–µ–Ω–∫–∞:** –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è bcrypt —Å salt rounds = 10, —á—Ç–æ —è–≤–ª—è–µ—Ç—Å—è industry standard. –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∑–∞—â–∏—Ç–∞ –æ—Ç timing attacks —á–µ—Ä–µ–∑ `safePasswordCompare`.

---

### 5.2 ‚úÖ –•–û–†–û–®–û: CSRF Protection

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/middleware/csrf.ts`

**–û—Ü–µ–Ω–∫–∞:** –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è double-submit cookie pattern. CSRF —Ç–æ–∫–µ–Ω—ã –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç—Å—è –Ω–∞ –æ—Å–Ω–æ–≤–µ session secret.

---

### 5.3 ‚ö†Ô∏è MEDIUM: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

**–ü—Ä–æ–±–ª–µ–º–∞:**
–¢–æ–∫–µ–Ω—ã –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –∫–∞—Ä—Ç (`yukassaPaymentToken`) —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ë–î –≤ plaintext.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–®–∏—Ñ—Ä–æ–≤–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å –ø–æ–º–æ—â—å—é AES-256:
```typescript
import crypto from 'crypto';

const ENCRYPTION_KEY = process.env.ENCRYPTION_KEY; // 32 –±–∞–π—Ç–∞
const IV_LENGTH = 16;

function encrypt(text: string): string {
  const iv = crypto.randomBytes(IV_LENGTH);
  const cipher = crypto.createCipheriv('aes-256-cbc', Buffer.from(ENCRYPTION_KEY), iv);
  let encrypted = cipher.update(text);
  encrypted = Buffer.concat([encrypted, cipher.final()]);
  return iv.toString('hex') + ':' + encrypted.toString('hex');
}
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1

---

### 5.4 ‚ö†Ô∏è LOW: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/middleware/requestLogger.ts`, `server/utils/logger.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í –ª–æ–≥–∞—Ö –º–æ–≥—É—Ç –ø–æ–ø–∞–¥–∞—Ç—å –ø–∞—Ä–æ–ª–∏, —Ç–æ–∫–µ–Ω—ã –∏ –¥—Ä—É–≥–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ req.body.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–°–æ–∑–¥–∞—Ç—å middleware –¥–ª—è –º–∞—Å–∫–∏—Ä–æ–≤–∞–Ω–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π:
```typescript
function sanitizeLogData(data: any): any {
  const sensitive = ['password', 'passwordHash', 'token', 'cardNumber'];
  // –†–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –º–∞—Å–∫–∏—Ä–æ–≤–∫–∞
}
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2

---

## 6. FRONTEND –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–¨

### 6.1 ‚úÖ –•–û–†–û–®–û: XSS Protection

**–û—Ü–µ–Ω–∫–∞:** React –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `dangerouslySetInnerHTML` –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ.

---

### 6.2 ‚úÖ –•–û–†–û–®–û: Secure API Communications

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `client/src/lib/api.ts`

**–û—Ü–µ–Ω–∫–∞:** –í—Å–µ –∑–∞–ø—Ä–æ—Å—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç `credentials: 'include'` –¥–ª—è –ø–µ—Ä–µ–¥–∞—á–∏ cookies, Content-Type –ø—Ä–∞–≤–∏–ª—å–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω.

---

### 6.3 ‚ö†Ô∏è LOW: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ CSRF —Ç–æ–∫–µ–Ω–∞ –≤ API –∫–ª–∏–µ–Ω—Ç–µ

**–ü—Ä–æ–±–ª–µ–º–∞:**
API –∫–ª–∏–µ–Ω—Ç –Ω–µ –≤–∫–ª—é—á–∞–µ—Ç CSRF —Ç–æ–∫–µ–Ω –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤.

**–¢–µ–∫—É—â–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:**
```typescript
async function fetchApi<T>(endpoint: string, options: RequestInit = {}): Promise<T> {
  const headers: Record<string, string> = {
    ...(options.headers as Record<string, string>),
  };
  // ‚ùå –ù–µ—Ç 'x-csrf-token'
}
```

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –ü–æ–ª—É—á–∏—Ç—å CSRF —Ç–æ–∫–µ–Ω –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
const csrfToken = await fetch('/api/csrf-token').then(r => r.json());

// –î–æ–±–∞–≤–∏—Ç—å –≤ –∫–∞–∂–¥—ã–π –∑–∞–ø—Ä–æ—Å
headers['x-csrf-token'] = csrfToken;
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø (–∑–∞—â–∏—Ç–∞ —É–∂–µ –µ—Å—Ç—å —á–µ—Ä–µ–∑ cookie)  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2

---

## 7. –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö –ò –£–°–¢–û–ô–ß–ò–í–û–°–¢–¨

### 7.1 ‚úÖ –•–û–†–û–®–û: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/middleware/errorHandler.ts`

**–û—Ü–µ–Ω–∫–∞:** –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ Zod, AppError –∏ database –æ—à–∏–±–æ–∫. –°—Ç–µ–∫-—Ç—Ä–µ–π—Å—ã –Ω–µ –ø–æ–ø–∞–¥–∞—é—Ç –≤ production.

---

### 7.2 ‚ö†Ô∏è MEDIUM: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ retry –º–µ—Ö–∞–Ω–∏–∑–º–∞ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ–π –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ë–î –∏–ª–∏ payment gateway –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Å—Ç–æ —Ñ–µ–π–ª—è—Ç—Å—è –±–µ–∑ –ø–æ–ø—ã—Ç–æ–∫ –ø–æ–≤—Ç–æ—Ä–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–í–Ω–µ–¥—Ä–∏—Ç—å retry –ª–æ–≥–∏–∫—É —Å exponential backoff –¥–ª—è:
- Database connection
- Payment API calls
- Email –æ—Ç–ø—Ä–∞–≤–∫–∞

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2

---

### 7.3 üîß LOW: Graceful Shutdown –º–æ–∂–µ—Ç –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—å—Å—è

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/index.ts` (—Å—Ç—Ä–æ–∫–∏ 130-188)

**–ü—Ä–æ–±–ª–µ–º–∞:**
Timeout 30 —Å–µ–∫—É–Ω–¥ –º–æ–∂–µ—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –≤—Å–µ—Ö –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∏ –∑–∞–∫—Ä—ã—Ç–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –£–≤–µ–ª–∏—á–∏—Ç—å timeout –¥–æ 60 —Å–µ–∫—É–Ω–¥
- –î–æ–±–∞–≤–∏—Ç—å tracking –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–µ–∫—Ä–∞—Ç–∏—Ç—å –ø—Ä–∏–Ω–∏–º–∞—Ç—å –Ω–æ–≤—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å—Ä–∞–∑—É –ø—Ä–∏ SIGTERM

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P3

---

## 8. –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ò DEPLOYMENT

### 8.1 ‚úÖ –•–û–†–û–®–û: Environment Variables

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/env.ts`

**–û—Ü–µ–Ω–∫–∞:** –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —á–µ—Ä–µ–∑ Zod schema, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä—è—é—Ç—Å—è –Ω–∞ —Å—Ç–∞—Ä—Ç–µ.

---

### 8.2 ‚ö†Ô∏è MEDIUM: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ health check endpoint

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ù–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–¥–æ—Ä–æ–≤—å—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –µ–≥–æ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å `/api/health`:
```typescript
router.get('/health', async (req, res) => {
  const checks = {
    database: await checkDatabaseConnection(),
    redis: await checkRedisConnection(),
    diskSpace: await checkDiskSpace(),
  };
  
  const healthy = Object.values(checks).every(c => c.ok);
  res.status(healthy ? 200 : 503).json(checks);
});
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1

---

### 8.3 üîß LOW: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ proxy

**–ü—Ä–æ–±–ª–µ–º–∞:**
Rate limiting —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –Ω–∞ —É—Ä–æ–≤–Ω–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±–æ–π–¥–µ–Ω —á–µ—Ä–µ–∑ –ø—Ä—è–º—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∫ —Å–µ—Ä–≤–µ—Ä—É.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ù–∞—Å—Ç—Ä–æ–∏—Ç—å rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ nginx/cloudflare –ø–µ—Ä–µ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º.

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P3

---

## 9. –°–ü–ï–¶–ò–§–ò–ß–ù–´–ï –†–ò–°–ö–ò E-COMMERCE

### 9.1 ‚ö†Ô∏è CRITICAL: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –ø–ª–∞—Ç–µ–∂–µ–π

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/orders.routes.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–∞ —Å –æ–ø–ª–∞—Ç–æ–π –¥—É–±–ª–∏—Ä—É–µ—Ç—Å—è (network retry), –º–æ–∂–µ—Ç –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω–æ –¥–≤–∞ –∑–∞–∫–∞–∑–∞ –∏ –¥–≤–∞ –ø–ª–∞—Ç–µ–∂–∞.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å idempotency key:
```typescript
router.post("/", authenticateToken, async (req, res) => {
  const idempotencyKey = req.headers['idempotency-key'];
  
  // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –Ω–µ –æ–±—Ä–∞–±–æ—Ç–∞–Ω –ª–∏ —É–∂–µ —ç—Ç–æ—Ç –∫–ª—é—á
  const existingOrder = await checkIdempotencyKey(idempotencyKey);
  if (existingOrder) {
    return res.json(existingOrder);
  }
  
  // –°–æ–∑–¥–∞—Ç—å –∑–∞–∫–∞–∑ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å idempotency key
});
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0

---

### 9.2 ‚ö†Ô∏è HIGH: Webhook –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å YooKassa

**–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `server/routes/webhooks.routes.ts`

**–ü—Ä–æ–±–ª–µ–º–∞:**
–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ø–∏—Å–∏ webhook –æ—Ç YooKassa. –ó–ª–æ—É–º—ã—à–ª–µ–Ω–Ω–∏–∫ –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–¥–¥–µ–ª—å–Ω—ã–π webhook –∏ –ø–æ–º–µ—Ç–∏—Ç—å –∑–∞–∫–∞–∑ –∫–∞–∫ –æ–ø–ª–∞—á–µ–Ω–Ω—ã–π.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
function verifyYooKassaWebhook(req: Request): boolean {
  const signature = req.headers['x-yookassa-signature'];
  const body = req.rawBody;
  
  const hmac = crypto
    .createHmac('sha256', env.YUKASSA_SECRET_KEY)
    .update(body)
    .digest('hex');
  
  return crypto.timingSafeEqual(
    Buffer.from(signature),
    Buffer.from(hmac)
  );
}
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –í–´–°–û–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P0

---

### 9.3 ‚ö†Ô∏è MEDIUM: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ fraud detection

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ù–µ—Ç –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö –∑–∞–∫–∞–∑–æ–≤:
- –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–∫–∞–∑—ã —Å —Ä–∞–∑–Ω—ã—Ö –∞–∫–∫–∞—É–Ω—Ç–æ–≤ –Ω–∞ –æ–¥–∏–Ω –∞–¥—Ä–µ—Å
- –ê–Ω–æ–º–∞–ª—å–Ω–æ –±–æ–ª—å—à–∏–µ –∑–∞–∫–∞–∑—ã –æ—Ç –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ë—ã—Å—Ç—Ä–∞—è —Å–º–µ–Ω–∞ –∞–¥—Ä–µ—Å–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–í–Ω–µ–¥—Ä–∏—Ç—å –±–∞–∑–æ–≤—É—é —Å–∏—Å—Ç–µ–º—É fraud scoring.

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P2

---

## 10. COMPLIANCE –ò GDPR

### 10.1 ‚ö†Ô∏è MEDIUM: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–∞ —É–¥–∞–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–ü—Ä–æ–±–ª–µ–º–∞:**
GDPR —Ç—Ä–µ–±—É–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ "–ø—Ä–∞–≤–æ –Ω–∞ –∑–∞–±–≤–µ–Ω–∏–µ". –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è –∞–∫–∫–∞—É–Ω—Ç–∞ –∏ –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–î–æ–±–∞–≤–∏—Ç—å `/api/auth/delete-account` —Å –∫–∞—Å–∫–∞–¥–Ω—ã–º —É–¥–∞–ª–µ–Ω–∏–µ–º –≤—Å–µ—Ö —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏–ª–∏ –∞–Ω–æ–Ω–∏–º–∏–∑–∞—Ü–∏–µ–π –∑–∞–∫–∞–∑–æ–≤.

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –°–†–ï–î–ù–Ø–Ø (–ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å EU –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏)  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P1

---

### 10.2 üîß LOW: –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ data retention policy

**–ü—Ä–æ–±–ª–µ–º–∞:**
–°—Ç–∞—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ (—Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏, –ª–æ–≥–∏) –Ω–∞–∫–∞–ø–ª–∏–≤–∞—é—Ç—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É:
```typescript
// –í server/storage.ts —É–∂–µ –µ—Å—Ç—å deleteOldMessages, –Ω–æ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è
async function scheduleDataCleanup() {
  // –£–¥–∞–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å—Ç–∞—Ä—à–µ 90 –¥–Ω–µ–π
  await storage.deleteOldMessages(90);
  
  // –ê–Ω–æ–Ω–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Å—Ç–∞—Ä—ã–µ –∑–∞–∫–∞–∑—ã (>2 –≥–æ–¥–∞)
}
```

**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** –ù–ò–ó–ö–ê–Ø  
**–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç:** P3

---

## 11. –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–´–ï –ú–û–ú–ï–ù–¢–´ (BEST PRACTICES)

### ‚úÖ –û—Ç–ª–∏—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è:

1. **Path Traversal Protection**: –ö–ª–∞—Å—Å `PathSecurityValidator` –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω—É—é –∑–∞—â–∏—Ç—É –æ—Ç path traversal –∞—Ç–∞–∫
2. **Session Management**: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ PostgreSQL –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–µ—Å—Å–∏–π, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ cookies (httpOnly, secure, sameSite)
3. **Rate Limiting**: –î–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤ –æ–ø–µ—Ä–∞—Ü–∏–π
4. **Input Validation**: Zod —Å—Ö–µ–º—ã –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∏–ø–æ–≤
5. **Image Processing**: –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —á–µ—Ä–µ–∑ Sharp —Å –≤–∞–ª–∏–¥–∞—Ü–∏–µ–π
6. **Logging**: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Winston
7. **Database Indexing**: –•–æ—Ä–æ—à–æ –ø—Ä–æ–¥—É–º–∞–Ω–Ω—ã–µ –∏–Ω–¥–µ–∫—Å—ã –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
8. **Type Safety**: –ü–æ–ª–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TypeScript —Å —Å—Ç—Ä–æ–≥–∏–º–∏ —Ç–∏–ø–∞–º–∏
9. **Error Handling**: –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ HTTP —Å—Ç–∞—Ç—É—Å–∞–º–∏
10. **WebSocket Security**: –í–∞–ª–∏–¥–∞—Ü–∏—è —Å–µ—Å—Å–∏–π –¥–ª—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

---

## 12. –ü–†–ò–û–†–ò–¢–ò–ó–ò–†–û–í–ê–ù–ù–´–ô –ü–õ–ê–ù –î–ï–ô–°–¢–í–ò–ô

### P0 - –ö–†–ò–¢–ò–ß–ù–û (–ò—Å–ø—Ä–∞–≤–∏—Ç—å –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ):

1. ‚úÖ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—ã—Ä—ã—Ö SQL-–∑–∞–ø—Ä–æ—Å–æ–≤ –Ω–∞ Drizzle ORM
2. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ä–µ—Å—É—Ä—Å–∞ (IDOR fix)
3. ‚úÖ –ò—Å–ø—Ä–∞–≤–∏—Ç—å race condition –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –æ—Å—Ç–∞—Ç–∫–æ–≤
4. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø–ª–∞—Ç–µ–∂–µ–π
5. ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –ø–æ–¥–ø–∏—Å–∏ YooKassa webhook
6. ‚úÖ –î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ–π –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏

### P1 - –í–´–°–û–ö–ò–ô (–í —Ç–µ—á–µ–Ω–∏–µ 1-2 –Ω–µ–¥–µ–ª—å):

1. ‚ö° –ü–æ–≤—Ç–æ—Ä–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ email –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
2. ‚ö° –£—Å–∏–ª–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é –ø–∞—Ä–æ–ª–µ–π
3. ‚ö° –ò—Å–ø—Ä–∞–≤–∏—Ç—å CORS –¥–ª—è production
4. ‚ö° –®–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤ –ø–ª–∞—Ç–µ–∂–Ω—ã—Ö –∫–∞—Ä—Ç
5. ‚ö° Health check endpoint
6. ‚ö° GDPR compliance (—É–¥–∞–ª–µ–Ω–∏–µ –∞–∫–∫–∞—É–Ω—Ç–∞)

### P2 - –°–†–ï–î–ù–ò–ô (–í —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞):

1. üîÑ Timing-safe —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤
2. üîÑ –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ security logging
3. üîÑ –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏ –≤ —Å–µ—Ä–≤–∏—Å—ã
4. üîÑ Retry –º–µ—Ö–∞–Ω–∏–∑–º –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
5. üîÑ N+1 query fixes
6. üîÑ –ú–∞—Å–∫–∏—Ä–æ–≤–∫–∞ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ –ª–æ–≥–∞—Ö
7. üîÑ –ë–∞–∑–æ–≤—ã–π fraud detection

### P3 - –ù–ò–ó–ö–ò–ô (Backlog):

1. üìã –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ magic numbers
2. üìã –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
3. üìã Composite –∏–Ω–¥–µ–∫—Å—ã
4. üìã –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ Redis
5. üìã –£–ª—É—á—à–µ–Ω–∏–µ graceful shutdown
6. üìã Data retention policy
7. üìã Rate limiting –Ω–∞ proxy —É—Ä–æ–≤–Ω–µ

---

## 13. –ú–ï–¢–†–ò–ö–ò –ò –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ö–û–î–ê

**–§–∞–π–ª—ã –ø—Ä–æ–∞–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:**
- Server routes: 12 —Ñ–∞–π–ª–æ–≤
- Server middleware: 8 —Ñ–∞–π–ª–æ–≤  
- Server utils: 10 —Ñ–∞–π–ª–æ–≤
- Shared schemas: 1 —Ñ–∞–π–ª
- Client API: 1 —Ñ–∞–π–ª
- Database schema: 1 —Ñ–∞–π–ª

**–ù–∞–π–¥–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:**
- –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ: 3
- –í—ã—Å–æ–∫–∏–µ: 4
- –°—Ä–µ–¥–Ω–∏–µ: 11
- –ù–∏–∑–∫–∏–µ: 9

**–í—Å–µ–≥–æ –ø—Ä–æ–±–ª–µ–º:** 27  
**–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫:** 10

---

## 14. –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –≤—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–æ–π –∑—Ä–µ–ª–æ—Å—Ç–∏ –∏ –≤–Ω–∏–º–∞–Ω–∏–µ –∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø—Ä–æ–¥—É–º–∞–Ω–∞, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–µ best practices. –û–¥–Ω–∞–∫–æ –≤—ã—è–≤–ª–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ–±–ª–µ–º—ã, —Ç—Ä–µ–±—É—é—â–∏–µ –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —á–∞—Å—Ç–∏:

1. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π** (race conditions, –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å)
2. **Webhook –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** (–æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏)
3. **IDOR –∑–∞—â–∏—Ç—ã** (–ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ —Ä–µ—Å—É—Ä—Å–æ–≤)

–ü–æ—Å–ª–µ —É—Å—Ç—Ä–∞–Ω–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞ P0 –∏ P1, –ø—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤ –∫ production deployment —Å –≤—ã—Å–æ–∫–∏–º —É—Ä–æ–≤–Ω–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –∏ –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏.

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π —Å—Ä–æ–∫ –¥–æ production:** 2-3 –Ω–µ–¥–µ–ª–∏  
**–ò—Ç–æ–≥–æ–≤–∞—è –æ—Ü–µ–Ω–∫–∞ –ø–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π:** 9.5/10

---

**–ê—É–¥–∏—Ç–æ—Ä:** Replit AI Agent  
**–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è:** OWASP Top 10, CWE Top 25, E-commerce Security Best Practices  
**–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:** –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞, Code Review, Security Pattern Analysis
