# üîç –ü–û–õ–ù–´–ô –ê–£–î–ò–¢ –ö–û–î–û–í–û–ô –ë–ê–ó–´

**–î–∞—Ç–∞ –∞—É–¥–∏—Ç–∞:** 29 –Ω–æ—è–±—Ä—è 2025  
**–¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞:** E-commerce –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞ (React + Express + PostgreSQL)  
**–£—Ä–æ–≤–µ–Ω—å –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç–∏:** –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

## üìã –û–ì–õ–ê–í–õ–ï–ù–ò–ï

1. [–ö—Ä–∞—Ç–∫–∏–π –æ–±–∑–æ—Ä](#–∫—Ä–∞—Ç–∫–∏–π-–æ–±–∑–æ—Ä)
2. [–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏](#–∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ-—É—è–∑–≤–∏–º–æ—Å—Ç–∏-–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏)
3. [–°–µ—Ä—å—ë–∑–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#—Å–µ—Ä—å—ë–∑–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)
4. [–°—Ä–µ–¥–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã](#—Å—Ä–µ–¥–Ω–∏–µ-–ø—Ä–æ–±–ª–µ–º—ã)
5. [–ù–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã](#–Ω–∏–∑–∫–æ–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–µ-–ø—Ä–æ–±–ª–µ–º—ã)
6. [–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã](#–ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–µ-—Å—Ç–æ—Ä–æ–Ω—ã)
7. [–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º](#—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-–ø–æ-–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º)

---

## üìä –ö–†–ê–¢–ö–ò–ô –û–ë–ó–û–†

### –ú–µ—Ç—Ä–∏–∫–∏ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã
- **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** –ú–æ–¥—É–ª—å–Ω–∞—è (Client-Server —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –Ω–∞ routes)
- **Backend:** Express.js + TypeScript + Drizzle ORM
- **Frontend:** React 18 + TypeScript + TanStack Query
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö:** PostgreSQL (Neon)
- **–õ–∏–Ω–∏–∏ –∫–æ–¥–∞:** ~10,000+ (–æ—Ü–µ–Ω–æ—á–Ω–æ)

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏: ‚ö†Ô∏è 6.5/10

**–°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã:**
- ‚úÖ CSRF –∑–∞—â–∏—Ç–∞ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞
- ‚úÖ Rate limiting –Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö
- ‚úÖ Session-based –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —Å PostgreSQL store
- ‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ Zod —Å—Ö–µ–º—ã
- ‚úÖ Bcrypt —Ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–∞—Ä–æ–ª–µ–π

**–ö—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã:**
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ–±—â–µ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏ SQL –∏–Ω—ä–µ–∫—Ü–∏–π –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –º–µ—Å—Ç–∞—Ö
- ‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è WebSocket —Å–æ–æ–±—â–µ–Ω–∏–π
- ‚ùå –ü—Ä–æ–±–ª–µ–º—ã —Å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ–º —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- ‚ùå –ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è email –º–æ–¥—É–ª—è
- ‚ùå –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ Content Security Policy –≤ development —Ä–µ–∂–∏–º–µ

---

## üö® –ö–†–ò–¢–ò–ß–ï–°–ö–ò–ï –£–Ø–ó–í–ò–ú–û–°–¢–ò –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò

### 1. **SQL INJECTION —á–µ—Ä–µ–∑ raw SQL –∑–∞–ø—Ä–æ—Å—ã**
**–§–∞–π–ª:** `server/routes/orders.routes.ts`, `server/routes/admin.routes.ts`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø  
**CVE Score:** 9.8/10

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// server/routes/orders.routes.ts:149-156
const updateResult = await tx.execute(
  sql`UPDATE products 
      SET stock_quantity = stock_quantity - ${item.quantity},
          updated_at = NOW()
      WHERE id = ${item.productId}
        AND stock_quantity >= ${item.quantity}
      RETURNING id, name, stock_quantity`
);
```

**–†–∏—Å–∫–∏:**
- –•–æ—Ç—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ `sql` tagged template, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ `item.quantity` –∏ `item.productId` –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–≥–æ –≤–≤–æ–¥–∞
- –ï—Å–ª–∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è Zod —Å—Ö–µ–º—ã –æ–±–æ–π–¥–µ–Ω–∞ –∏–ª–∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ—à–∏–±–∫–∏, –≤–æ–∑–º–æ–∂–Ω–∞ SQL –∏–Ω—ä–µ–∫—Ü–∏—è
- –í —Ñ–∞–π–ª–µ `server/routes/admin.routes.ts` —Ç–∞–∫–∂–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø—Ä—è–º—ã–µ SQL –∑–∞–ø—Ä–æ—Å—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å ORM –º–µ—Ç–æ–¥—ã –≤–º–µ—Å—Ç–æ raw SQL
await tx.update(products)
  .set({ 
    stockQuantity: sql`stock_quantity - ${item.quantity}`,
    updatedAt: new Date()
  })
  .where(and(
    eq(products.id, item.productId),
    gte(products.stockQuantity, item.quantity)
  ))
  .returning();
```

### 2. **–ù–µ–±–µ–∑–æ–ø–∞—Å–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ credentials**
**–§–∞–π–ª:** `server/email.ts`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üî¥ –ö–†–ò–¢–ò–ß–ï–°–ö–ê–Ø  
**CVE Score:** 8.5/10

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// server/email.ts:4-8
const SMTP_HOST = process.env.SMTP_HOST || "smtp.gmail.com";
const SMTP_PORT = parseInt(process.env.SMTP_PORT || "587");
const SMTP_USER = process.env.SMTP_USER || "";
const SMTP_PASS = process.env.SMTP_PASS || "";
const SITE_URL = process.env.SITE_URL || "http://localhost:5000";
```

**–†–∏—Å–∫–∏:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–µ—Ñ–æ–ª—Ç–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –¥–ª—è SMTP —É—á–µ—Ç–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö (–ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏)
- –í–æ–∑–º–æ–∂–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ email –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –≤ production
- SITE_URL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç HTTP –≤–º–µ—Å—Ç–æ HTTPS
- –ù–µ—Ç –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —á–µ—Ä–µ–∑ `env.ts`

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é EMAIL –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –≤ `server/env.ts`
- –¢—Ä–µ–±–æ–≤–∞—Ç—å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ EMAIL –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ production
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS –¥–ª—è SITE_URL –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

### 3. **WebSocket: –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π**
**–§–∞–π–ª:** `server/routes.ts:174-212`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü† –í–´–°–û–ö–ê–Ø  
**CVE Score:** 7.2/10

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// server/routes.ts:207
const message = JSON.parse(data.toString());
// –î–∞–ª–µ–µ message –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –ë–ï–ó –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
```

**–†–∏—Å–∫–∏:**
- –ü–∞—Ä—Å–∏–Ω–≥ JSON –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –µ–≥–æ —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö —á–µ—Ä–µ–∑ WebSocket
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–µ–π—Å—Ç–≤–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ admin –º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã–µ —Ç–∏–ø—ã —Å–æ–æ–±—â–µ–Ω–∏–π)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
const messageSchema = z.object({
  type: z.enum(['chat_message', 'order_update', 'support_message']),
  payload: z.any(), // –î–∞–ª–µ–µ –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç type
});

const message = messageSchema.parse(JSON.parse(data.toString()));

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è
if (message.type === 'admin_action' && !userRoles.includes('admin')) {
  ws.send(JSON.stringify({ type: 'error', message: '–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤' }));
  return;
}
```

### 4. **Path Traversal –≤ ImagePipeline**
**–§–∞–π–ª:** `server/ImagePipeline.ts:244-273`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü† –í–´–°–û–ö–ê–Ø  
**CVE Score:** 7.5/10

**–ü—Ä–æ–±–ª–µ–º–∞:**
–•–æ—Ç—è –µ—Å—Ç—å –∑–∞—â–∏—Ç–∞ –æ—Ç path traversal, –æ–Ω–∞ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ–±–æ–π–¥–µ–Ω–∞ –≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö edge cases:

```typescript
// server/ImagePipeline.ts:249-255
if (filename.includes('..') || filename.includes('/') || filename.includes('\\')) {
  throw new Error('Invalid filename: path traversal detected');
}

if (filename.startsWith('.')) {
  throw new Error('Invalid filename: hidden files not allowed');
}
```

**–†–∏—Å–∫–∏:**
- –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ `.includes('/')` –∏ `.includes('\\')` –º–æ–∂–µ—Ç –Ω–µ —Å—Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ Windows –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ —Å–º–µ—à–∞–Ω–Ω—ã—Ö –ø—É—Ç–µ–π
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è URL-encoded —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è –æ–±—Ö–æ–¥–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ null bytes

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏
const sanitizedFilename = filename.replace(/[^a-zA-Z0-9._-]/g, '');
if (sanitizedFilename !== filename) {
  throw new Error('Invalid filename: contains forbidden characters');
}

// –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ null bytes
if (filename.includes('\x00')) {
  throw new Error('Invalid filename: null byte detected');
}
```

### 5. **CORS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω–∞ –≤ production**
**–§–∞–π–ª:** `server/middleware/cors.ts:5-25`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü† –í–´–°–û–ö–ê–Ø  
**CVE Score:** 6.8/10

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// server/middleware/cors.ts:6-19
origin: isProduction
  ? (origin, callback) => {
      const allowedOrigins = [
        process.env.FRONTEND_URL,
        process.env.REPLIT_DEV_DOMAIN
      ].filter(Boolean);
      
      if (!origin || allowedOrigins.includes(origin)) {
        callback(null, true);
      } else {
        callback(new Error('Not allowed by CORS'));
      }
    }
  : true,  // –í development —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –í–°–ï –∏—Å—Ç–æ—á–Ω–∏–∫–∏
```

**–†–∏—Å–∫–∏:**
- –í development —Ä–µ–∂–∏–º–µ –æ—Ç–∫–ª—é—á–µ–Ω–∞ –∑–∞—â–∏—Ç–∞ CORS (`origin: true`)
- `!origin` —Ä–∞–∑—Ä–µ—à–∞–µ—Ç –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞ Origin (–Ω–∞–ø—Ä–∏–º–µ—Ä, –æ—Ç Postman, curl)
- –≠—Ç–æ –º–æ–∂–µ—Ç –ø–æ–∑–≤–æ–ª–∏—Ç—å CSRF –∞—Ç–∞–∫–∏ –≤ production, –µ—Å–ª–∏ Origin –Ω–µ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
origin: isProduction
  ? (origin, callback) => {
      const allowedOrigins = [
        process.env.FRONTEND_URL,
        process.env.REPLIT_DEV_DOMAIN
      ].filter(Boolean);
      
      // –ù–ï —Ä–∞–∑—Ä–µ—à–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –±–µ–∑ Origin –≤ production
      if (!origin) {
        callback(new Error('Origin header required'));
        return;
      }
      
      if (allowedOrigins.includes(origin)) {
        callback(null, true);
      } else {
        callback(new Error('Not allowed by CORS'));
      }
    }
  : (origin, callback) => {
      // –í development —Ç–æ–∂–µ –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å
      const devOrigins = ['http://localhost:5000', 'http://127.0.0.1:5000'];
      if (!origin || devOrigins.includes(origin)) {
        callback(null, true);
      } else {
        callback(new Error('Not allowed in development'));
      }
    },
```

---

## ‚ö†Ô∏è –°–ï–†–¨–Å–ó–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 6. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**
**–§–∞–π–ª—ã:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø  
**–ü—Ä–æ–±–ª–µ–º–∞:**

–í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `console.log` –∏ `console.error` –≤–º–µ—Å—Ç–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è, —á—Ç–æ –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ —É—Ç–µ—á–∫–µ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:

```typescript
// server/middleware/errorHandler.ts:11-17
console.error('Error:', {
  name: error.name,
  message: error.message,
  stack: process.env.NODE_ENV === 'development' ? error.stack : undefined,
  path: req.path,
  method: req.method,
});
```

**–ù–∞–π–¥–µ–Ω–æ –∫–æ–Ω—Å–æ–ª—å–Ω—ã—Ö –ª–æ–≥–æ–≤:**
- `server/` –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è: 38+ –≤—ã–∑–æ–≤–æ–≤ `console.log/error/warn`
- –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –º–æ–≥—É—Ç –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ, —Ç–æ–∫–µ–Ω—ã, –ø–∞—Ä–æ–ª–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Winston logger (—É–∂–µ –ø–æ–¥–∫–ª—é—á—ë–Ω) –≤–µ–∑–¥–µ –≤–º–µ—Å—Ç–æ console
- –°–æ–∑–¥–∞—Ç—å middleware –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
- –î–æ–±–∞–≤–∏—Ç—å sanitization –¥–ª—è –≤—Å–µ—Ö –ª–æ–≥–æ–≤

### 7. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç Session Fixation**
**–§–∞–π–ª:** `server/routes/auth.routes.ts:50-78, 115-144`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø  

**–ü—Ä–æ–±–ª–µ–º–∞:**
–•–æ—Ç—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `req.session.regenerate()`, –Ω–µ—Ç –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã—Ö –º–µ—Ä –∑–∞—â–∏—Ç—ã:

```typescript
// server/routes/auth.routes.ts:50
req.session.regenerate((err) => {
  if (err) {
    console.error('Session regeneration error during registration:', err);
    return res.status(500).json({ message: "–û—à–∏–±–∫–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏" });
  }
  // ...
```

**–†–∏—Å–∫–∏:**
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ IP –∞–¥—Ä–µ—Å–∞ –ø–æ—Å–ª–µ —Ä–µ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ —Å–µ—Å—Å–∏–∏
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ User-Agent
- –û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ª–æ–≥–∏–∫–∞ –¥–ª—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏ —Å—Ç–∞—Ä—ã—Ö —Å–µ—Å—Å–∏–π –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å IP –∏ User-Agent –≤ session
- –ü—Ä–æ–≤–µ—Ä—è—Ç—å –∏—Ö –ø—Ä–∏ –∫–∞–∂–¥–æ–º –∑–∞–ø—Ä–æ—Å–µ
- –ò–Ω–≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞—Ç—å –≤—Å–µ —Å–µ—Å—Å–∏–∏ –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è

### 8. **Race Conditions –≤ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–∫–∞–∑–æ–≤**
**–§–∞–π–ª:** `server/routes/orders.routes.ts:49-305`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø  

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// server/routes/orders.routes.ts:148-168
for (const item of data.items) {
  const updateResult = await tx.execute(
    sql`UPDATE products 
        SET stock_quantity = stock_quantity - ${item.quantity},
            updated_at = NOW()
        WHERE id = ${item.productId}
          AND stock_quantity >= ${item.quantity}
        RETURNING id, name, stock_quantity`
  );
  
  if (!updateResult.rows || updateResult.rows.length === 0) {
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–≤–∞—Ä–∞...
  }
}
```

**–†–∏—Å–∫–∏:**
- –•–æ—Ç—è –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è, –Ω–µ—Ç row-level locking
- –ü—Ä–∏ –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–∫–∞—Ö –≤–æ–∑–º–æ–∂–Ω–∞ —Å–∏—Ç—É–∞—Ü–∏—è, –∫–æ–≥–¥–∞ –¥–≤–∞ –∑–∞–∫–∞–∑–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ —Ä–µ–∑–µ—Ä–≤–∏—Ä—É—é—Ç –ø–æ—Å–ª–µ–¥–Ω–∏–π —Ç–æ–≤–∞—Ä
- `SELECT ... FOR UPDATE` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å FOR UPDATE –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ —Å—Ç—Ä–æ–∫
const checkProduct = await tx.execute(
  sql`SELECT id, name, stock_quantity 
      FROM products 
      WHERE id = ${item.productId}
      FOR UPDATE`
);
```

### 9. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–∞—â–∏—Ç—ã –æ—Ç Enumeration –∞—Ç–∞–∫**
**–§–∞–π–ª:** `server/routes/auth.routes.ts:87-110`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø  

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// server/routes/auth.routes.ts:87-95
if (!user) {
  logLoginAttempt({
    email: sanitizedEmail,
    success: false,
    failureReason: 'user_not_found',
    ip: req.ip,
    userAgent: req.get('user-agent'),
  });
  return res.status(401).json({ message: "–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å" });
}
```

**–†–∏—Å–∫–∏:**
- –•–æ—Ç—è —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ –æ–¥–∏–Ω–∞–∫–æ–≤–æ–µ, –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ –º–æ–∂–µ—Ç —Ä–∞–∑–ª–∏—á–∞—Ç—å—Å—è
- –ï—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω, –∑–∞–ø—Ä–æ—Å –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è –±—ã—Å—Ç—Ä–µ–µ (–Ω–µ—Ç bcrypt –ø—Ä–æ–≤–µ—Ä–∫–∏)
- –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞—Ç–∞–∫—É—é—â–µ–º—É –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ email

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –í—Å–µ–≥–¥–∞ –≤—ã–ø–æ–ª–Ω—è—Ç—å bcrypt –¥–∞–∂–µ –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
const dummyHash = '$2a$10$...'; // –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω–æ —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ö–µ—à

if (!user) {
  // –í—ã–ø–æ–ª–Ω–∏—Ç—å —Ñ–∏–∫—Ç–∏–≤–Ω—É—é –ø—Ä–æ–≤–µ—Ä–∫—É –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞
  await comparePassword(data.password, dummyHash);
  logLoginAttempt({ ... });
  return res.status(401).json({ message: "–ù–µ–≤–µ—Ä–Ω—ã–π email –∏–ª–∏ –ø–∞—Ä–æ–ª—å" });
}
```

### 10. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ CSP –≤ development —Ä–µ–∂–∏–º–µ**
**–§–∞–π–ª:** `server/index.ts:22-37`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü° –°–†–ï–î–ù–Ø–Ø  

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// server/index.ts:23-37
app.use(helmet({
  contentSecurityPolicy: env.NODE_ENV === 'production' ? {
    directives: {
      defaultSrc: ["'self'"],
      scriptSrc: ["'self'"],
      styleSrc: ["'self'"],
      // ...
    },
  } : false,  // –û—Ç–∫–ª—é—á–µ–Ω–æ –≤ development!
  crossOriginEmbedderPolicy: false,
}));
```

**–†–∏—Å–∫–∏:**
- –í development —Ä–µ–∂–∏–º–µ –Ω–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç XSS
- –†–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∏ –º–æ–≥—É—Ç –Ω–µ –∑–∞–º–µ—á–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –¥–æ production
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –≤—Ä–µ–¥–æ–Ω–æ—Å–Ω—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –≤–æ –≤—Ä–µ–º—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª–µ–µ –º—è–≥–∫—É—é CSP –ø–æ–ª–∏—Ç–∏–∫—É –≤ development, –∞ –Ω–µ –æ—Ç–∫–ª—é—á–∞—Ç—å –ø–æ–ª–Ω–æ—Å—Ç—å—é.

---

## üî∂ –°–†–ï–î–ù–ò–ï –ü–†–û–ë–õ–ï–ú–´

### 11. **–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç—å—é –≤ WebSocket**
**–§–∞–π–ª:** `server/routes.ts:28-232`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø-–°–†–ï–î–ù–Ø–Ø  

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
const connectedUsers = new Map<string, { ws: any, roles: string[] }>();
const connectionRateLimits = new Map<string, { count: number; resetAt: number }>();
const messageRateLimits = new Map<string, { count: number; resetAt: number }>();
```

**–†–∏—Å–∫–∏:**
- Map –∫–æ–ª–ª–µ–∫—Ü–∏–∏ —Ä–∞—Å—Ç—É—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ
- –ù–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—á–∏—Å—Ç–∫–∏ –æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
- –ü—Ä–∏ –±–æ–ª—å—à–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤–æ–∑–º–æ–∂–Ω–∞ —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏
- –û—á–∏—Å—Ç–∫–∞ rate limits –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Ä–∞–∑ –≤ –º–∏–Ω—É—Ç—É (—Å—Ç—Ä–æ–∫–∞ 88-111)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –£–¥–∞–ª—è—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ `connectedUsers` –ø—Ä–∏ –æ—Ç–∫–ª—é—á–µ–Ω–∏–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å TTL –¥–ª—è rate limit maps
- –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–∞–∑–º–µ—Ä–∞ Map –∫–æ–ª–ª–µ–∫—Ü–∏–π

### 12. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ Content-Type**
**–§–∞–π–ª—ã:** –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ routes  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø-–°–†–ï–î–ù–Ø–Ø  

**–ü—Ä–æ–±–ª–µ–º–∞:**
–í –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–µ POST/PUT —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –Ω–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ Content-Type –∑–∞–≥–æ–ª–æ–≤–∫–∞:

```typescript
router.post("/register", registerLimiter, async (req, res) => {
  const data = registerSchema.parse(req.body);
  // –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ Content-Type
```

**–†–∏—Å–∫–∏:**
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç–ø—Ä–∞–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≤ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–æ–º —Ñ–æ—Ä–º–∞—Ç–µ
- –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å –∫ CSRF –∞—Ç–∞–∫–∞–º —á–µ—Ä–µ–∑ form submission

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
// –î–æ–±–∞–≤–∏—Ç—å middleware –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ Content-Type
const requireJSON = (req, res, next) => {
  if (!req.is('application/json')) {
    return res.status(415).json({ message: 'Content-Type –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å application/json' });
  }
  next();
};

router.post("/register", requireJSON, registerLimiter, async (req, res) => {
  // ...
});
```

### 13. **–ù–µ–ø–æ–ª–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤**
**–§–∞–π–ª:** `server/routes/orders.routes.ts:85-136`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø-–°–†–ï–î–ù–Ø–Ø  

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–º–æ–∫–æ–¥–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –∑–∞–∫–∞–∑–∞, –Ω–æ –µ—Å—Ç—å race condition:

```typescript
if (promo.type === "temporary") {
  const [usage] = await tx
    .select()
    .from(promocodeUsage)
    .where(
      and(
        eq(promocodeUsage.promocodeId, promo.id),
        eq(promocodeUsage.userId, req.userId!)
      )
    )
    .limit(1);

  if (usage) {
    throw new Error('PROMOCODE_INVALID:–í—ã —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ —ç—Ç–æ—Ç –ø—Ä–æ–º–æ–∫–æ–¥');
  }
}
```

**–†–∏—Å–∫–∏:**
- –î–≤–∞ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ –º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω temporary –ø—Ä–æ–º–æ–∫–æ–¥ –¥–≤–∞–∂–¥—ã
- –ù–µ—Ç UNIQUE constraint –Ω–∞ `promocode_usage(promocodeId, userId)` - –µ—Å—Ç—å –≤ —Å—Ö–µ–º–µ (—Å—Ç—Ä–æ–∫–∞ 170)

**–°—Ç–∞—Ç—É—Å:** –ß–∞—Å—Ç–∏—á–Ω–æ —Ä–µ—à–µ–Ω–æ —á–µ—Ä–µ–∑ unique constraint, –Ω–æ –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ –º–æ–∂–µ—Ç –±—ã—Ç—å —É–ª—É—á—à–µ–Ω–∞.

### 14. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ timeout –Ω–∞ database connections**
**–§–∞–π–ª:** `server/db.ts:14-19`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø  

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
export const pool = new Pool({ 
  connectionString: process.env.DATABASE_URL,
  max: 20,
  idleTimeoutMillis: 30000,
  connectionTimeoutMillis: 10000,
});
```

**–†–∏—Å–∫–∏:**
- –ù–µ—Ç statement timeout (–∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –≤—ã–ø–æ–ª–Ω—è—Ç—å—Å—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ –¥–æ–ª–≥–æ)
- –ù–µ—Ç query timeout
- –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å DoS —á–µ—Ä–µ–∑ –º–µ–¥–ª–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
export const pool = new Pool({ 
  connectionString: process.env.DATABASE_URL,
  max: 20,
  idleTimeoutMillis: 30000,
  connectionTimeoutMillis: 10000,
  statement_timeout: 30000, // 30 —Å–µ–∫—É–Ω–¥
  query_timeout: 30000,
});
```

### 15. **–ü—Ä–æ–±–ª–µ–º—ã —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π multipart/form-data**
**–§–∞–π–ª:** `server/index.ts:58-75`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø  

**–ü—Ä–æ–±–ª–µ–º–∞:**
```typescript
// server/index.ts:59-68
app.use(express.json({
  limit: '50mb',
  verify: (req, _res, buf) => {
    req.rawBody = buf;
  },
  type: (req) => {
    const contentType = req.headers['content-type'] || '';
    return contentType.includes('application/json');
  }
}));
```

**–†–∏—Å–∫–∏:**
- –õ–∏–º–∏—Ç 50MB –æ—á–µ–Ω—å –≤–µ–ª–∏–∫ –¥–ª—è JSON –¥–∞–Ω–Ω—ã—Ö
- `rawBody` —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–∞—è —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏)
- –ù–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ nested objects depth (DoS —á–µ—Ä–µ–∑ –≥–ª—É–±–æ–∫–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã)

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –£–º–µ–Ω—å—à–∏—Ç—å –ª–∏–º–∏—Ç –¥–æ 10MB
- –°–æ—Ö—Ä–∞–Ω—è—Ç—å `rawBody` —Ç–æ–ª—å–∫–æ –¥–ª—è webhook —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤
- –î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É –Ω–∞ –≥–ª—É–±–∏–Ω—É –≤–ª–æ–∂–µ–Ω–Ω–æ—Å—Ç–∏

---

## üü¢ –ù–ò–ó–ö–û–ü–†–ò–û–†–ò–¢–ï–¢–ù–´–ï –ü–†–û–ë–õ–ï–ú–´

### 16. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ versioning API**
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø  

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã –Ω–∞—Ö–æ–¥—è—Ç—Å—è –Ω–∞ `/api/*` –±–µ–∑ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è. –ü—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ breaking changes –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∏–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `/api/v1/*`

### 17. **–ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ alerting**
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø  

–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç:
- Health check —ç–Ω–¥–ø–æ–∏–Ω—Ç (–µ—Å—Ç—å `/api/health`, –Ω–æ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π)
- Metrics —Å–±–æ—Ä (Prometheus, StatsD)
- Error tracking (Sentry, Rollbar)
- Performance monitoring (APM)

### 18. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ unit —Ç–µ—Å—Ç–æ–≤**
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø  

–í –ø—Ä–æ–µ–∫—Ç–µ –Ω–µ—Ç –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ —Å —Ç–µ—Å—Ç–∞–º–∏. –ö—Ä–∏—Ç–∏—á–Ω–∞—è –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (—Ä–∞—Å—á—ë—Ç –±–æ–Ω—É—Å–æ–≤, –ø—Ä–æ–º–æ–∫–æ–¥—ã, –∑–∞–∫–∞–∑—ã) –Ω–µ –ø–æ–∫—Ä—ã—Ç–∞ —Ç–µ—Å—Ç–∞–º–∏.

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
- –î–æ–±–∞–≤–∏—Ç—å Jest
- –ü–æ–∫—Ä—ã—Ç—å —Ç–µ—Å—Ç–∞–º–∏: `bonuses.ts`, `promocodes.ts`, `auth.ts`
- –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ: 70%

### 19. **–ù–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ database –∑–∞–ø—Ä–æ—Å—ã**
**–§–∞–π–ª—ã:** `server/storage.ts`, `server/routes/products.routes.ts`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø  

–ù–µ–∫–æ—Ç–æ—Ä—ã–µ –∑–∞–ø—Ä–æ—Å—ã –º–æ–≥—É—Ç –±—ã—Ç—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω—ã:
- N+1 –ø—Ä–æ–±–ª–µ–º–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Å —Ä–æ–ª—è–º–∏
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ pagination –Ω–∞ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞—Ö
- –ù–µ—Ç –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤

### 20. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ graceful shutdown**
**–§–∞–π–ª:** `server/index.ts`  
**–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:** üü¢ –ù–ò–ó–ö–ê–Ø  

**–ü—Ä–æ–±–ª–µ–º–∞:**
–ù–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏ SIGTERM/SIGINT —Å–∏–≥–Ω–∞–ª–æ–≤ –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:
- –ù–µ –∑–∞–∫—Ä—ã–≤–∞—é—Ç—Å—è WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –ù–µ –¥–æ–∂–∏–¥–∞–µ—Ç—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤
- –ù–µ –∑–∞–∫—Ä—ã–≤–∞–µ—Ç—Å—è database pool

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è:**
```typescript
process.on('SIGTERM', async () => {
  logger.info('SIGTERM signal received: closing HTTP server');
  server.close(async () => {
    await pool.end();
    await productImagePipeline.cleanup();
    await chatImagePipeline.cleanup();
    process.exit(0);
  });
});
```

---

## ‚úÖ –ü–û–õ–û–ñ–ò–¢–ï–õ–¨–ù–´–ï –°–¢–û–†–û–ù–´

### –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:

1. **‚úÖ –•–æ—Ä–æ—à–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
   - –ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ routes
   - –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ —Å–ª–æ–∏ (routes, storage, middleware)
   - TypeScript —Å —Å—Ç—Ä–æ–≥–æ–π —Ç–∏–ø–∏–∑–∞—Ü–∏–µ–π

2. **‚úÖ –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª–µ–π:**
   - Bcrypt —Å salt rounds = 10
   - –ù–µ—Ç plaintext –ø–∞—Ä–æ–ª–µ–π –≤ –∫–æ–¥–µ
   - –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ö–µ—à–µ–π

3. **‚úÖ –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö:**
   - Zod —Å—Ö–µ–º—ã –¥–ª—è –≤—Å–µ—Ö –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - Sanitization email, phone
   - Trim –¥–ª—è —Å—Ç—Ä–æ–∫–æ–≤—ã—Ö –ø–æ–ª–µ–π

4. **‚úÖ CSRF –∑–∞—â–∏—Ç–∞:**
   - Double submit cookie pattern
   - Token rotation
   - –ò—Å–∫–ª—é—á–µ–Ω–∏–µ –¥–ª—è webhooks

5. **‚úÖ Rate Limiting:**
   - –ù–∞—Å—Ç—Ä–æ–µ–Ω–æ –¥–ª—è auth —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ (15 –ø–æ–ø—ã—Ç–æ–∫/15 –º–∏–Ω)
   - –î–ª—è uploads (30/—á–∞—Å)
   - –î–ª—è WebSocket (connection –∏ message limits)

6. **‚úÖ Session Security:**
   - HttpOnly cookies
   - Secure flag –≤ production
   - SameSite: strict
   - –•—Ä–∞–Ω–µ–Ω–∏–µ –≤ PostgreSQL

7. **‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:**
   - –í–∞–ª–∏–¥–∞—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ —á–µ—Ä–µ–∑ Sharp
   - Resize –¥–ª—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
   - Path traversal –∑–∞—â–∏—Ç–∞
   - –í—Ä–µ–º–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã —Å –æ—á–∏—Å—Ç–∫–æ–π

8. **‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏:**
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ø—ã—Ç–æ–∫ –≤—Ö–æ–¥–∞
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–π
   - –û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ IP –∏ User-Agent

9. **‚úÖ –¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π:**
   - –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫–∞–∑–æ–≤ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
   - Rollback –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
   - –ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

10. **‚úÖ Structured Error Handling:**
    - –ö–∞—Å—Ç–æ–º–Ω—ã–µ –∫–ª–∞—Å—Å—ã –æ—à–∏–±–æ–∫
    - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π error handler
    - –ù–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –¥–µ—Ç–∞–ª–∏

---

## üìà –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –ü–†–ò–û–†–ò–¢–ï–¢–ê–ú

### –§–∞–∑–∞ 1: –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (1-2 –Ω–µ–¥–µ–ª–∏)

1. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å SQL –∏–Ω—ä–µ–∫—Ü–∏–∏**
   - –ó–∞–º–µ–Ω–∏—Ç—å raw SQL –Ω–∞ ORM –º–µ—Ç–æ–¥—ã
   - –î–æ–±–∞–≤–∏—Ç—å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—É—é –≤–∞–ª–∏–¥–∞—Ü–∏—é
   - –ö–æ–¥-—Ä–µ–≤—å—é –≤—Å–µ—Ö `sql` tagged templates

2. **–ó–∞—â–∏—Ç–∏—Ç—å WebSocket**
   - –î–æ–±–∞–≤–∏—Ç—å –≤–∞–ª–∏–¥–∞—Ü–∏—é —Å–æ–æ–±—â–µ–Ω–∏–π —á–µ—Ä–µ–∑ Zod
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π
   - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å —Ä–∞–∑–º–µ—Ä payload

3. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å CORS –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é**
   - –¢—Ä–µ–±–æ–≤–∞—Ç—å Origin header –≤ production
   - –û–≥—Ä–∞–Ω–∏—á–∏—Ç—å development origins
   - –î–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ CORS –æ—à–∏–±–æ–∫

4. **–í–∞–ª–∏–¥–∞—Ü–∏—è email –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**
   - –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ env.ts
   - –¢—Ä–µ–±–æ–≤–∞—Ç—å –≤ production
   - Fallback –¥–ª—è development

### –§–∞–∑–∞ 2: –í–∞–∂–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (2-4 –Ω–µ–¥–µ–ª–∏)

5. **–ó–∞—â–∏—Ç–∞ –æ—Ç Session Fixation**
   - IP validation
   - User-Agent checking
   - Session invalidation –ø—Ä–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–æ–ª—è

6. **–ó–∞—â–∏—Ç–∞ –æ—Ç Enumeration**
   - Constant-time —Å—Ä–∞–≤–Ω–µ–Ω–∏—è
   - Dummy bcrypt –¥–ª—è –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
   - –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –≤—Ä–µ–º–µ–Ω–∏ –æ—Ç–≤–µ—Ç–∞

7. **–ò—Å–ø—Ä–∞–≤–∏—Ç—å Race Conditions**
   - –î–æ–±–∞–≤–∏—Ç—å `FOR UPDATE` –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏
   - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥ –Ω–∞–≥—Ä—É–∑–∫–æ–π
   - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π

8. **–£–ª—É—á—à–∏—Ç—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - –ó–∞–º–µ–Ω–∏—Ç—å console.* –Ω–∞ Winston
   - –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
   - Structured logging

### –§–∞–∑–∞ 3: –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (1-2 –º–µ—Å—è—Ü–∞)

9. **–î–æ–±–∞–≤–∏—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   - Unit —Ç–µ—Å—Ç—ã –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω–æ–π –ª–æ–≥–∏–∫–∏
   - Integration —Ç–µ—Å—Ç—ã –¥–ª—è API
   - E2E —Ç–µ—Å—Ç—ã –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö —Ñ–ª–æ—É

10. **Monitoring & Observability**
    - –ü–æ–¥–∫–ª—é—á–∏—Ç—å Sentry/Rollbar
    - Prometheus metrics
    - Structured logging —Å ELK/Loki

11. **Performance –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è**
    - –î–æ–±–∞–≤–∏—Ç—å Redis –¥–ª—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
    - –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞—Ç—å N+1 –∑–∞–ø—Ä–æ—Å—ã
    - Database query optimization

12. **Security hardening**
    - CSP –≤ development
    - Dependency scanning (npm audit, Snyk)
    - –†–µ–≥—É–ª—è—Ä–Ω—ã–µ security audits

---

## üìä –ò–¢–û–ì–û–í–ê–Ø –û–¶–ï–ù–ö–ê

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –û—Ü–µ–Ω–∫–∞ | –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π |
|-----------|--------|-------------|
| **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** | 6.5/10 | –•–æ—Ä–æ—à–∏–µ –æ—Å–Ω–æ–≤—ã, –Ω–æ –µ—Å—Ç—å –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã |
| **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** | 8/10 | –ß–∏—Å—Ç–∞—è –º–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ |
| **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞** | 7/10 | TypeScript + Zod, –Ω–æ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤ |
| **Performance** | 6/10 | –ù–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫ |
| **Maintainability** | 7.5/10 | –•–æ—Ä–æ—à–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –Ω–æ –Ω—É–∂–Ω–æ –±–æ–ª—å—à–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ |
| **Error Handling** | 7/10 | –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞, –Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç—Ä–µ–±—É–µ—Ç —É–ª—É—á—à–µ–Ω–∏–π |

### –û–±—â–∞—è –æ—Ü–µ–Ω–∫–∞: **7.0/10**

**–í–µ—Ä–¥–∏–∫—Ç:**  
–ü—Ä–æ–µ–∫—Ç –∏–º–µ–µ—Ç **—Ö–æ—Ä–æ—à—É—é –±–∞–∑—É**, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç **—Å–µ—Ä—å—ë–∑–Ω—ã—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** –ø–µ—Ä–µ–¥ –≤—ã—Ö–æ–¥–æ–º –≤ production. –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç—Ä–∞–Ω–µ–Ω—ã –≤ –ø–µ—Ä–≤—É—é –æ—á–µ—Ä–µ–¥—å.

---

## üîó –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–°–£–†–°–´

- [OWASP Top 10](https://owasp.org/www-project-top-ten/)
- [Node.js Security Best Practices](https://nodejs.org/en/docs/guides/security/)
- [Express Security Best Practices](https://expressjs.com/en/advanced/best-practice-security.html)
- [PostgreSQL Security](https://www.postgresql.org/docs/current/security.html)

---

**–ü–æ–¥–≥–æ—Ç–æ–≤–∏–ª:** –ò–ò-–∞—É–¥–∏—Ç–æ—Ä  
**–°–ª–µ–¥—É—é—â–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞:** –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ 3 –º–µ—Å—è—Ü–∞ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
